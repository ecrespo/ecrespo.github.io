
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://ecrespo.github.io/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://ecrespo.github.io/theme/pygments/monokai.min.css">
  <link rel="stylesheet" type="text/css" href="https://ecrespo.github.io/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://ecrespo.github.io/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://ecrespo.github.io/theme/font-awesome/css/solid.css">


    <link href="https://ecrespo.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Página de Seraph Atom">



<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-131517246-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->
    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#333333">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#333333">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Microsoft EDGE -->
    <meta name="msapplication-TileColor" content="#333333">

<meta name="author" content="Ernesto Crespo" />
<meta name="description" content="Continuando con los artículos sobre django, en este caso se usará django-celery para envío de mensajes a un servidor kannel (servidor sms) y django-tastypie para mostrar el resultado por medio de API rest full con json. En los dos artículos anteriores Manejo de colas de RabbitMQ en django con django-celery …" />
<meta name="keywords" content="Canaima, Debian, General, Linux, Python, Ubuntu, Django">

<meta property="og:site_name" content="Página de Seraph"/>
<meta property="og:title" content="Restful API con Django-tastypie y Django-Celery"/>
<meta property="og:description" content="Continuando con los artículos sobre django, en este caso se usará django-celery para envío de mensajes a un servidor kannel (servidor sms) y django-tastypie para mostrar el resultado por medio de API rest full con json. En los dos artículos anteriores Manejo de colas de RabbitMQ en django con django-celery …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://ecrespo.github.io/restful-api-con-django-tastypie-y-django-celery.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2014-07-19 09:00:00-04:30"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://ecrespo.github.io/author/ernesto-crespo.html">
<meta property="article:section" content="Tutorial Python"/>
<meta property="article:tag" content="Canaima"/>
<meta property="article:tag" content="Debian"/>
<meta property="article:tag" content="General"/>
<meta property="article:tag" content="Linux"/>
<meta property="article:tag" content="Python"/>
<meta property="article:tag" content="Ubuntu"/>
<meta property="article:tag" content="Django"/>
<meta property="og:image" content="//s.gravatar.com/avatar/7fab2070e149e57fe99da94d7ccbad6b?s=120">

  <title>Página de Seraph &ndash; Restful API con Django-tastypie y Django-Celery</title>

</head>
<body>
  <aside>
    <div>
      <a href="https://ecrespo.github.io">
        <img src="//s.gravatar.com/avatar/7fab2070e149e57fe99da94d7ccbad6b?s=120" alt="Ernesto Crespo" title="Ernesto Crespo">
      </a>
      <h1><a href="https://ecrespo.github.io">Ernesto Crespo</a></h1>

<p>Data Scientist </p>
      <nav>
        <ul class="list">
          <li><a href="https://ecrespo.github.io/pages/About.html#About">Acerca</a></li>
          <li><a href="https://ecrespo.github.io/pages/Contacto.html#Contacto">Contacto</a></li>

        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-medium" href="https://medium.com/@_seraph1" target="_blank">
            <i class="fab fa-medium">
            </i>
          </a></li>
          <li>
            <a  class="sc-linkedin" href="http://ve.linkedin.com/in/ernestocrespo" target="_blank">
            <i class="fab fa-linkedin">
            </i>
          </a></li>
          <li>
            <a  class="sc-github" href="https://github.com/ecrespo" target="_blank">
            <i class="fab fa-github">
            </i>
          </a></li>
          <li>
            <a  class="sc-google" href="https://google.com/+ErnestoCrespo" target="_blank">
            <i class="fab fa-google">
            </i>
          </a></li>
          <li>
            <a  class="sc-twitter" href="https://twitter.com/_seraph1" target="_blank">
            <i class="fab fa-twitter">
            </i>
          </a></li>
          <li>
            <a  class="sc-facebook" href="https://www.facebook.com/ernesto.crespo" target="_blank">
            <i class="fab fa-facebook">
            </i>
          </a></li>
          <li>
            <a  class="sc-gitlab" href="https://gitlab.com/ecrespo" target="_blank">
            <i class="fab fa-gitlab">
            </i>
          </a></li>
          <li>
            <a  class="sc-soundcloud" href="https://soundcloud.com/ernesto-crespo" target="_blank">
            <i class="fab fa-soundcloud">
            </i>
          </a></li>
          <li>
            <a  class="sc-rss" href="//www.seraph.to/feeds/all.atom.xml" target="_blank">
            <i class="fas fa-rss">
            </i>
          </a></li>
      </ul>
    </div>
    
    <ul class="tagcloud">
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/material-design.html">
            Material design
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/unittest.html">
            unittest
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/gps.html">
            GPS
                    <span class="badge">2</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/camara.html">
            Camara
                    <span class="badge">4</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/pylab.html">
            pylab
                    <span class="badge">2</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/paramiko.html">
            Paramiko
                    <span class="badge">2</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/beautiful-soup.html">
            Beautiful Soup
                    <span class="badge">3</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/asus.html">
            Asus
                    <span class="badge">2</span>
            </a>
        </li>
        <li class="tag-2">
            <a href="https://ecrespo.github.io/tag/empaquetado.html">
            Empaquetado
                    <span class="badge">9</span>
            </a>
        </li>
        <li class="tag-1">
            <a href="https://ecrespo.github.io/tag/linux.html">
            Linux
                    <span class="badge">142</span>
            </a>
        </li>
        <li class="tag-1">
            <a href="https://ecrespo.github.io/tag/general.html">
            General
                    <span class="badge">107</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/arduino.html">
            Arduino
                    <span class="badge">2</span>
            </a>
        </li>
        <li class="tag-1">
            <a href="https://ecrespo.github.io/tag/debian.html">
            Debian
                    <span class="badge">146</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/dns.html">
            DNS
                    <span class="badge">3</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/redes.html">
            Redes
                    <span class="badge">5</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/aiohttp.html">
            aiohttp
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/scapy.html">
            scapy
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/webkit.html">
            webkit
                    <span class="badge">2</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/profiling.html">
            Profiling
                    <span class="badge">3</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/gconf.html">
            gconf
                    <span class="badge">4</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/ssh.html">
            ssh
                    <span class="badge">5</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/pyprocessing.html">
            Pyprocessing
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-2">
            <a href="https://ecrespo.github.io/tag/mercurial.html">
            Mercurial
                    <span class="badge">8</span>
            </a>
        </li>
        <li class="tag-2">
            <a href="https://ecrespo.github.io/tag/sympy.html">
            Sympy
                    <span class="badge">7</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/pdf-scraping.html">
            pdf scraping
                    <span class="badge">3</span>
            </a>
        </li>
        <li class="tag-2">
            <a href="https://ecrespo.github.io/tag/gtk.html">
            gtk
                    <span class="badge">15</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/qt.html">
            qt
                    <span class="badge">2</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/tareas.html">
            Tareas
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/tiflotecnologia.html">
            tiflotecnologia
                    <span class="badge">3</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/cerberus.html">
            Cerberus
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/pantalla-tactil.html">
            Pantalla táctil
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/reproductor-musica.html">
            Reproductor Música
                    <span class="badge">2</span>
            </a>
        </li>
        <li class="tag-2">
            <a href="https://ecrespo.github.io/tag/zeromq.html">
            ZeroMQ
                    <span class="badge">9</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/pylint.html">
            PyLint
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/videos.html">
            Videos
                    <span class="badge">2</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/paquetes.html">
            Paquetes
                    <span class="badge">2</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/mechanize.html">
            Mechanize
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/entorno-desarrollo.html">
            Entorno Desarrollo
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/dnsmasq.html">
            dnsmasq
                    <span class="badge">2</span>
            </a>
        </li>
        <li class="tag-2">
            <a href="https://ecrespo.github.io/tag/numpy.html">
            numpy
                    <span class="badge">21</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/line_profiler.html">
            line_profiler
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-1">
            <a href="https://ecrespo.github.io/tag/python.html">
            Python
                    <span class="badge">193</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/csvkit.html">
            csvkit
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/scipy.html">
            scipy
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/networkx.html">
            Networkx
                    <span class="badge">2</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/dia-debian.html">
            Dia Debian
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/ipcalc.html">
            ipcalc
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/urwid.html">
            urwid
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/tdd.html">
            TDD
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/tareas-periodicas.html">
            Tareas periodicas
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/wikipedia.html">
            Wikipedia
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/ncurses.html">
            ncurses
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/doctest.html">
            doctest
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-2">
            <a href="https://ecrespo.github.io/tag/django.html">
            Django
                    <span class="badge">9</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/python-lockfile.html">
            Python-lockfile
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/kvm.html">
            KVM
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/ipython.html">
            ipython
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/pudb.html">
            pudb
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/poo.html">
            POO
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/pypdf.html">
            pypdf
                    <span class="badge">2</span>
            </a>
        </li>
        <li class="tag-1">
            <a href="https://ecrespo.github.io/tag/android.html">
            Android
                    <span class="badge">41</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/flask.html">
            Flask
                    <span class="badge">3</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/api-rest.html">
            API rest
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/timeit.html">
            timeit
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/simplecv.html">
            SimpleCV
                    <span class="badge">4</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/exif.html">
            exif
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/pyflakes.html">
            Pyflakes
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/seguridad.html">
            Seguridad
                    <span class="badge">4</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/memcached.html">
            memcached
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/api-stream.html">
            API Stream
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/bitly.html">
            bit.ly
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/pyowm.html">
            PyOWM
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/pyqwt.html">
            pyQwt
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/csv.html">
            csv
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/django-celery.html">
            Django-Celery
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/scrapermark.html">
            Scrapermark
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/cprofile.html">
            cProfile
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/ciencia-de-datos.html">
            Ciencia de Datos
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/python-daemon.html">
            Python-daemon
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/asincrono.html">
            asincrono
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/data-science.html">
            Data Science
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-1">
            <a href="https://ecrespo.github.io/tag/ubuntu.html">
            Ubuntu
                    <span class="badge">102</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/google-translate.html">
            Google Translate
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-2">
            <a href="https://ecrespo.github.io/tag/webscraping.html">
            Webscraping
                    <span class="badge">8</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/fedora.html">
            Fedora
                    <span class="badge">2</span>
            </a>
        </li>
        <li class="tag-2">
            <a href="https://ecrespo.github.io/tag/matplotlib.html">
            matplotlib
                    <span class="badge">23</span>
            </a>
        </li>
        <li class="tag-2">
            <a href="https://ecrespo.github.io/tag/glade.html">
            glade
                    <span class="badge">14</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/rasberry-pi.html">
            Rasberry Pi
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-2">
            <a href="https://ecrespo.github.io/tag/pyqt.html">
            PyQt
                    <span class="badge">13</span>
            </a>
        </li>
        <li class="tag-2">
            <a href="https://ecrespo.github.io/tag/accesibilidad.html">
            Accesibilidad
                    <span class="badge">10</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/kivy.html">
            kivy
                    <span class="badge">3</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/mongodb.html">
            Mongodb
                    <span class="badge">5</span>
            </a>
        </li>
        <li class="tag-1">
            <a href="https://ecrespo.github.io/tag/canaima.html">
            Canaima
                    <span class="badge">91</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/grafos.html">
            grafos
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/rasbian.html">
            Rasbian
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/sms.html">
            SMS
                    <span class="badge">4</span>
            </a>
        </li>
        <li class="tag-2">
            <a href="https://ecrespo.github.io/tag/control-de-versiones.html">
            Control de versiones
                    <span class="badge">6</span>
            </a>
        </li>
        <li class="tag-2">
            <a href="https://ecrespo.github.io/tag/twitter.html">
            Twitter
                    <span class="badge">6</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/qemu.html">
            qemu
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-2">
            <a href="https://ecrespo.github.io/tag/gnome.html">
            gnome
                    <span class="badge">19</span>
            </a>
        </li>
   </ul>



  </aside>
  <main>

    <nav>
      <a href="https://ecrespo.github.io">    Home
</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="https://ecrespo.github.io/feeds/all.atom.xml">    Atom
</a>

    </nav>

<article class="single">
  <header>
      
    <h1 id="restful-api-con-django-tastypie-y-django-celery">Restful API con Django-tastypie y Django-Celery</h1>
    <p>
          Posted on sáb 19 julio 2014 in <a href="https://ecrespo.github.io/category/tutorial-python.html">Tutorial Python</a>


        &#8226; 7 min read
    </p>
  </header>


  <div>
    <p>Continuando con los artículos sobre django, en este caso se usará <code>django-celery</code> para envío de mensajes a un servidor kannel (servidor sms) y django-tastypie para mostrar el resultado por medio de API rest full con json.
En los dos artículos anteriores <a href="https://www.seraph.to/manejo-de-colas-de-rabbitmq-en-django-con-django-celery.html#manejo-de-colas-de-rabbitmq-en-django-con-django-celery">Manejo de colas de RabbitMQ en django con django-celery</a> y 
<a href="https://www.seraph.to/restful-api-con-django-tastypie.html#restful-api-con-django-tastypie">Restfult API con django tastypie</a> se tiene la base de este artículo. Este artículo se basa en el ejemplo de la mensajería sms del artículo de <a href="http://blog.crespo.org.ve/2014/05/restful-api-con-django-tastypie.html">Restfult API con django tastypie</a> (todo el proceso de creación del proyecto y de la aplicación sms fue explicada en ese artículo).</p>
<p>La idea ahora es poder mostrar los sms listados por evento, no es necesario estar creando una tabla que herede de las otras dos, esto será posible gracias a tastypie en una consulta del json.</p>
<p>Se usará como base de datos sqlite3. A continuación se muestra el archivo <code>settings.py</code>:</p>
<div class="highlight"><pre><span></span><span class="c1">#Archivo settings.py:</span>
<span class="c1">#Configuración de la base de datos sqlite3</span>
<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s1">&#39;django.db.backends.sqlite3&#39;</span><span class="p">,</span> <span class="c1"># Add &#39;postgresql_psycopg2&#39;, &#39;mysql&#39;, &#39;sqlite3&#39; or &#39;oracle&#39;.</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="s1">&#39;sms.db&#39;</span><span class="p">,</span>                      <span class="c1"># Or path to database file if using sqlite3.</span>
        <span class="s1">&#39;USER&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>                      <span class="c1"># Not used with sqlite3.</span>
        <span class="s1">&#39;PASSWORD&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>                  <span class="c1"># Not used with sqlite3.</span>
        <span class="s1">&#39;HOST&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>                      <span class="c1"># Set to empty string for localhost. Not used with sqlite3.</span>
        <span class="s1">&#39;PORT&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>                      <span class="c1"># Set to empty string for default. Not used with sqlite3.</span>
    <span class="p">}</span>
<span class="p">}</span>





<span class="c1">#Zona horaria y localización</span>


<span class="n">TIME_ZONE</span> <span class="o">=</span> <span class="s1">&#39;America/Caracas&#39;</span>

<span class="n">LANGUAGE_CODE</span> <span class="o">=</span> <span class="s1">&#39;es-ve&#39;</span> 

<span class="c1">#Aplicaciones instaladas (djcelery,pasarela.apps.sms,tastypie y south)</span>
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sites&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="c1"># Uncomment the next line to enable the admin:</span>
    <span class="s1">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;djcelery&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pasarela.apps.sms&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tastypie&#39;</span><span class="p">,</span>
    <span class="s1">&#39;south&#39;</span><span class="p">,</span>
    <span class="c1"># Uncomment the next line to enable admin documentation:</span>
    <span class="c1"># &#39;django.contrib.admindocs&#39;,</span>
<span class="p">)</span>


<span class="c1">#Conexión al servidor kannel </span>
<span class="n">direccion</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span>
<span class="n">portsms</span> <span class="o">=</span> <span class="s2">&quot;13013&quot;</span>
<span class="n">portadmin</span>  <span class="o">=</span> <span class="s2">&quot;13000&quot;</span>
<span class="n">usuario</span> <span class="o">=</span> <span class="s2">&quot;kannel&quot;</span>
<span class="n">clave</span> <span class="o">=</span> <span class="s2">&quot;kannel&quot;</span>
<span class="o">----------------------</span>
</pre></div>


<p>El archivo <code>pasarela/apps/sms/models.py</code>:</p>
<div class="highlight"><pre><span></span><span class="c1">#Archivo pasarela/apps/sms/models.py</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="c1">#Se crea la tabla Evento que contiene los campos evento (número del evento), el estatus del mismo (si se #termino el evento o no y si no termino fue por falla o no.</span>
<span class="k">class</span> <span class="nc">Evento</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">evento</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">estatus</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
       <span class="n">evento</span> <span class="o">=</span> <span class="s2">&quot;Evento: </span><span class="si">%s</span><span class="s2">, Estatus: </span><span class="si">%s</span><span class="s2"> , Falla: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evento</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">estatus</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">falla</span><span class="p">)</span>
       <span class="k">return</span> <span class="n">evento</span>

<span class="c1">#Se crea la tabla HistoricoSMS donde se tiene un campo</span>
<span class="c1">#foreignkey de la tablla evento, el mensaje, el número de celular, el estatus si se envío o no o si fallo.</span>
<span class="k">class</span> <span class="nc">HistoricoSMS</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">evento</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Evento</span><span class="p">)</span>
    <span class="n">mensaje</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
    <span class="n">numcel</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">estatus</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mensaje</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">&quot;</span>  <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evento</span><span class="o">.</span><span class="n">evento</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">numcel</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">estatus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mensaje</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">falla</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mensaje</span>
<span class="o">--------------------</span>
</pre></div>


<p>Archivo <code>pasarela/apps/sms/admin.py</code>:</p>
<div class="highlight"><pre><span></span><span class="c1">#Archivo pasarela/apps/sms/admin.py</span>
<span class="c1">#En este archivo se define que las tablas Evento e HistoricoSMS se puedan visualizar desde la #administración de django.</span>
<span class="kn">from</span> <span class="nn">django.contrib</span>  <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">pasarela.apps.sms.models</span> <span class="kn">import</span> <span class="n">HistoricoSMS</span><span class="p">,</span><span class="n">Evento</span>


<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">HistoricoSMS</span><span class="p">)</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Evento</span><span class="p">)</span>
</pre></div>


<p>Archivo <code>pasarela/apps/sms/api.py</code> (archivo para crear el api restful de django-tastypie), en este caso tiene varias modificaciones con respecto al artículo anterior sobre tastypie, ahora se agrega la variable filtering(más información sobre filtering en el siguiente <a href="https://django-tastypie.readthedocs.io/en/latest/resources.html">enlace</a>) que es un diccionario en cada recurso:</p>
<div class="highlight"><pre><span></span><span class="c1">#Se importa de tastypie.resources ModelResource, ALL y ALL_WITH_RELATIONS</span>
<span class="kn">from</span> <span class="nn">tastypie.resources</span> <span class="kn">import</span> <span class="n">ModelResource</span><span class="p">,</span> <span class="n">ALL</span><span class="p">,</span> <span class="n">ALL_WITH_RELATIONS</span>
<span class="c1">#Se importa del modelo HistoricoSMS y Evento</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">HistoricoSMS</span><span class="p">,</span><span class="n">Evento</span>
<span class="c1">#Se importa fields de tastypie</span>
<span class="kn">from</span> <span class="nn">tastypie</span> <span class="kn">import</span> <span class="n">fields</span>


<span class="k">class</span> <span class="nc">EventoResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">queryset</span> <span class="o">=</span><span class="n">Evento</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s1">&#39;evento&#39;</span>
<span class="c1">#Se muestra todos los eventos</span>
        <span class="n">filtering</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;evento&#39;</span><span class="p">:</span> <span class="n">ALL</span><span class="p">,</span>
        <span class="p">}</span>


<span class="k">class</span> <span class="nc">SMSResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="n">evento</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">EventoResource</span><span class="p">,</span> <span class="s1">&#39;evento&#39;</span><span class="p">)</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">HistoricoSMS</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s1">&#39;sms&#39;</span>
<span class="c1">#De evento se muestra todo con relación a el. de estatus se muestra exactamente lo que se necesita,</span>
<span class="c1">#acá también se puede usar para las consultas: [&#39;exact&#39;, &#39;range&#39;, &#39;gt&#39;, &#39;gte&#39;, &#39;lt&#39;, &#39;lte&#39;].</span>
        <span class="n">filtering</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;evento&#39;</span><span class="p">:</span> <span class="n">ALL_WITH_RELATIONS</span><span class="p">,</span>
            <span class="s1">&#39;estatus&#39;</span><span class="p">:[</span><span class="s1">&#39;exact&#39;</span><span class="p">],</span>
        <span class="p">}</span>
<span class="o">------------------------</span>
</pre></div>


<p>El archivo que permite manejar las tareas de celery <code>pasarela/apps/sms/tasks.py</code>:</p>
<div class="highlight"><pre><span></span><span class="c1">#Archivo pasarela/apps/sms/tasks.py</span>
<span class="kn">from</span> <span class="nn">celery</span> <span class="kn">import</span> <span class="n">Celery</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Celery</span><span class="p">(</span><span class="s1">&#39;tasks&#39;</span><span class="p">,</span> <span class="n">broker</span><span class="o">=</span><span class="s1">&#39;amqp://&#39;</span><span class="p">,</span><span class="n">backend</span><span class="o">=</span><span class="s1">&#39;amqp&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">urllib2</span> <span class="kn">import</span> <span class="n">urlopen</span>
<span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">urlencode</span>
<span class="kn">import</span> <span class="nn">urllib2</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">pasarela.apps.sms.models</span> <span class="kn">import</span> <span class="n">HistoricoSMS</span><span class="p">,</span><span class="n">Evento</span>



<span class="c1">#Conexión al servidor kannel (está configuración se puede pasar al archivo settings.py y usarla desde allí</span>
<span class="n">direccion</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">direccion</span>
<span class="n">portsms</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">portsms</span>
<span class="n">portadmin</span>  <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">portadmin</span>
<span class="n">usuario</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">usuario</span>
<span class="n">clave</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">clave</span>

<span class="c1">#Se define una tarea para celery por medio del decorador @task, se recibe un json para luego sea</span>
<span class="c1"># procesado.</span>
<span class="nd">@app.task</span>
<span class="k">def</span> <span class="nf">RecNums</span><span class="p">(</span><span class="n">datos</span><span class="p">):</span>
    <span class="c1">#Se toma el json y se convierte en un diccionario</span>
    <span class="n">diccionario</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">datos</span><span class="p">)</span>
    <span class="c1">#Se instancia la clave Evento(tabla Evento).</span>
    <span class="n">evento</span> <span class="o">=</span> <span class="n">Evento</span><span class="p">()</span>
    <span class="c1">#Se asigna cada variable del diccionario para trabajarlos directamente</span>
    <span class="k">for</span> <span class="n">clave</span> <span class="ow">in</span> <span class="n">diccionario</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">clave</span> <span class="o">==</span> <span class="s1">&#39;mensaje&#39;</span><span class="p">:</span>
            <span class="n">mensaje</span> <span class="o">=</span> <span class="n">diccionario</span><span class="p">[</span><span class="n">clave</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">clave</span> <span class="o">==</span> <span class="s1">&#39;numeros&#39;</span><span class="p">:</span>
            <span class="n">numeros</span> <span class="o">=</span> <span class="n">diccionario</span><span class="p">[</span><span class="n">clave</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">clave</span> <span class="o">==</span> <span class="s1">&#39;cantnumeros&#39;</span><span class="p">:</span>
            <span class="n">cantnum</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">diccionario</span><span class="p">[</span><span class="n">clave</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">clave</span> <span class="o">==</span> <span class="s1">&#39;evento&#39;</span><span class="p">:</span>
            <span class="n">eventoid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">diccionario</span><span class="p">[</span><span class="n">clave</span><span class="p">])</span>
    <span class="c1">#Se crea una lista para agregar todos los números de celular a dicha lista</span>
    <span class="n">lista</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">numeros</span><span class="p">:</span> <span class="n">lista</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
    <span class="c1">#A evento.evento se le asigna el id del evento.</span>
    <span class="n">evento</span><span class="o">.</span><span class="n">evento</span> <span class="o">=</span> <span class="n">eventoid</span>
    <span class="c1">#Si la lista es distinta a la variable cantnum se envía un mensaje de error, si no se procesa la lista</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lista</span><span class="p">)</span> <span class="o">==</span> <span class="n">cantnum</span><span class="p">:</span>
        <span class="c1">#Se envía al proceso Enviar (de celery) cada mensaje con su número celular, esperando un segundo </span>
        <span class="c1">#para procesar el siguiente.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lista</span><span class="p">)):</span>
            <span class="c1">#Se Envía el mensaje pasando el evento, el número celular de la lista y el mensaje</span>
            <span class="n">resultado</span> <span class="o">=</span> <span class="n">Enviar</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">evento</span><span class="p">,</span><span class="n">lista</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">mensaje</span><span class="p">)</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1">#Se asigna True al estatus del evento al terminar de procesar los mensajes.</span>
        <span class="n">evento</span><span class="o">.</span><span class="n">estatus</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c1">#Se salva los valores en la tabla Evento.</span>
        <span class="n">evento</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="s2">&quot;Se enviaron: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">cantnum</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">evento</span><span class="o">.</span><span class="n">estatus</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">evento</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="s2">&quot;Error en la recepcion de los datos&quot;</span>


<span class="c1">#Se crea la tarea de celery Enviar donde recibe el número del evento, el número de celular y la cantidad de </span>
<span class="c1">#intentos para enviar el sms el valor por defecto es 5.</span>
<span class="nd">@app.task</span>
<span class="k">def</span> <span class="nf">Enviar</span><span class="p">(</span><span class="n">evento</span><span class="p">,</span><span class="n">numcel</span><span class="p">,</span><span class="n">mensaje</span><span class="p">,</span><span class="n">intentos</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="c1">#Se instancia la clase HistoricoSMS que maneja dicha table de models.py</span>
    <span class="n">historico</span> <span class="o">=</span> <span class="n">HistoricoSMS</span><span class="p">()</span>
    <span class="c1">#Se le da forma de códificación url al mensaje para eliminar los espacios en blanco del mismo.</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">urlencode</span><span class="p">({</span><span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">mensaje</span><span class="p">})</span>
    <span class="c1">#se define la variable Url donde se tiene el url del servidor kannel donde se le pasa al texto</span>
    <span class="c1">#el usuario, la clave, el número celular y el mensaje a enviar.</span>
    <span class="n">Url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">/cgi-bin/sendsms?username=</span><span class="si">%s</span><span class="s2">&amp;password=</span><span class="si">%s</span><span class="s2">&amp;to=</span><span class="si">%s</span><span class="s2">&amp;text=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">direccion</span><span class="p">,</span><span class="n">portsms</span><span class="p">,</span><span class="n">usuario</span><span class="p">,</span><span class="n">clave</span><span class="p">,</span><span class="n">numcel</span><span class="p">,</span><span class="n">form</span><span class="p">)</span>
    <span class="c1">#Se maneja una excepción si hay un error de comunicación http.</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="c1">#Se abre el Url</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="n">Url</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="c1">#Se asigna los valores numcel, mensaje y evento al objeto historico.</span>
        <span class="n">historico</span><span class="o">.</span><span class="n">numcel</span> <span class="o">=</span> <span class="n">numcel</span>
        <span class="n">historico</span><span class="o">.</span><span class="n">mensaje</span> <span class="o">=</span> <span class="n">mensaje</span>
        <span class="n">historico</span><span class="o">.</span><span class="n">evento</span> <span class="o">=</span> <span class="n">evento</span>
        <span class="c1">#Se lee el resultado de abrir el url, si se tiene el mensaje  de encolado para enviar más tarde</span>
        <span class="c1">#se asigna el estatus False y se salva devolviendo el mensaje de no enviado </span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="o">&lt;&gt;</span> <span class="s1">&#39;3: Queued for later delivery&#39;</span><span class="p">:</span>
            <span class="n">historico</span><span class="o">.</span><span class="n">estatus</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">historico</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="s1">&#39;Mensaje no enviado a: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">numcel</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Se envío el mensaje se coloca el estatus en True y se salva en la tabla</span>
            <span class="n">historico</span><span class="o">.</span><span class="n">estatus</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">historico</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="c1">#Se devuelve el mensaje de mensaje enviado.</span>
            <span class="k">return</span> <span class="s1">&#39;Mensaje enviado a: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">numcel</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">urllib2</span><span class="o">.</span><span class="n">URLError</span><span class="p">,</span><span class="n">urllib2</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">),</span><span class="n">exc</span><span class="p">:</span>
    <span class="c1">#Si hay una excepción de error http se reintenta el envío llamando de forma </span>
    <span class="c1">#concurrente a esta misma función reduciendo el valor de los intentos, </span>
    <span class="c1">#cuando llegue a cero el número de intentos se devuelve un mensaje de no enviado </span>
        <span class="k">if</span> <span class="n">intentos</span> <span class="o">&lt;&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">Enviar</span><span class="p">(</span><span class="n">evento</span><span class="p">,</span><span class="n">numcel</span><span class="p">,</span><span class="n">mensaje</span><span class="p">,</span><span class="n">intentos</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Se salva los valores en la tabla y devuelve el mensaje de sms no enviado</span>
            <span class="n">historico</span><span class="o">.</span><span class="n">numcel</span> <span class="o">=</span> <span class="n">numcel</span>
            <span class="n">historico</span><span class="o">.</span><span class="n">mensaje</span> <span class="o">=</span> <span class="n">mensaje</span>
            <span class="n">historico</span><span class="o">.</span><span class="n">evento</span> <span class="o">=</span> <span class="n">evento</span>
            <span class="n">historico</span><span class="o">.</span><span class="n">estatus</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">historico</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span><span class="s1">&#39;No hay conexion al kannel por puerto o IP, el numero que no se procesaron es: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">numcel</span>
<span class="o">----------------------------</span>
</pre></div>


<p>A continuación se muestra el contenido del archivo pasarela/urls.py el cual contiene el acceso al API como se explico en el artículo anterior y ahora tiene el acceso a la función que permite recibir los datos para enviar (estos datos se pasan por un json):</p>
<div class="highlight"><pre><span></span><span class="c1">#Archivo pasarela/urls.py</span>
<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">include</span><span class="p">,</span> <span class="n">url</span>

<span class="kn">from</span> <span class="nn">djcelery</span> <span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">celery_views</span>
<span class="kn">from</span> <span class="nn">pasarela.apps.sms</span> <span class="kn">import</span> <span class="n">tasks</span>

<span class="c1"># Uncomment the next two lines to enable the admin:</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="n">admin</span><span class="o">.</span><span class="n">autodiscover</span><span class="p">()</span>

<span class="c1">#Se importa Api de tastypie.api</span>
<span class="kn">from</span> <span class="nn">tastypie.api</span> <span class="kn">import</span> <span class="n">Api</span>
<span class="kn">from</span> <span class="nn">apps.sms.api</span> <span class="kn">import</span> <span class="n">SMSResource</span><span class="p">,</span><span class="n">EventoResource</span>

<span class="n">v1_api</span> <span class="o">=</span> <span class="n">Api</span><span class="p">(</span><span class="n">api_name</span><span class="o">=</span><span class="s1">&#39;v1&#39;</span><span class="p">)</span>
<span class="c1">#Se registra los recursos en la instancia del api.</span>
<span class="n">v1_api</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">SMSResource</span><span class="p">())</span>
<span class="n">v1_api</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">EventoResource</span><span class="p">())</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="c1"># Uncomment the next line to enable the admin:</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^admin/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span>
    <span class="c1">#Acceso al API</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^api/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">v1_api</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span>
    <span class="c1">#se define enviar que usa la vista de tareas de celery para ejecutar tasks.RecNums</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^enviar/&#39;</span><span class="p">,</span> <span class="n">celery_views</span><span class="o">.</span><span class="n">task_view</span><span class="p">(</span><span class="n">tasks</span><span class="o">.</span><span class="n">RecNums</span><span class="p">)),</span>
    <span class="c1">#Consulta a celery si la tarea se ejecuto sin problemas</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(?P&lt;task_id&gt;[\w\d\-]+)/done/?$&#39;</span><span class="p">,</span> <span class="n">celery_views</span><span class="o">.</span><span class="n">is_task_successful</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;celery-is_task_successful&quot;</span><span class="p">),</span>
    <span class="c1">#Consulta de celery para ver el estatus de la tarea</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(?P&lt;task_id&gt;[\w\d\-]+)/status/?$&#39;</span><span class="p">,</span> <span class="n">celery_views</span><span class="o">.</span><span class="n">task_status</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;celery-task_status&quot;</span><span class="p">),</span>
<span class="p">)</span>
<span class="o">-----------------------</span>
</pre></div>


<p>La base de datos se sincroniza como se explicó en los artículos anteriores, ahora toca ejecutar en modo pruba django-celery, django como tal y abrir un interprete de comandos para django.</p>
<p>Ejecución de django-celery con dos colas de rabbitMQ y en modo info:</p>
<div class="highlight"><pre><span></span>python manage.py celeryd -E -l info -c 2
</pre></div>


<p>A continuación captura de pantalla de la ejecución:</p>
<p><img alt="" src="./images/restfulapicondjangotastypieydjangocelery-1.png"></p>
<p>Note que se tienen 2 tareas en el <code>celery</code>:
- pasarela.apps.sms.tasks.Enviar
- pasarela.apps.sms.tasks.RecNums
Ahora se ejecuta django en el 127.0.0.1 y puerto 8080:
python manage.py runserver 127.0.0.1:8080
A continuación una captura de pantalla de la ejecución del comando:</p>
<p><img alt="" src="./images/restfulapicondjangotastypieydjangocelery-2.png"></p>
<p>Y por último se ejecuta el comando para tener un shell interfactivo de django:
python manage.py shell
A continuación la captura de pantalla: </p>
<p><img alt="" src="./images/restfulapicondjangotastypieydjangocelery-3.png"></p>
<p>Ahora se ejecutará en el shell una prueba que simula la recepción por parte de la tarea del json que recibe de una aplicación externa para enviar los sms:
Hay que acotar que los números de celular de la prueba no corresponden a números  reales o de proveedores de teléfonía celular.</p>
<p><img alt="" src="./images/restfulapicondjangotastypieydjangocelery-4.png"></p>
<p>Ahora para complementar la idea de consulta API restful por json del artículo anterior la idea es listar los números celulares que se enviaron del evento 6, en este caso se usará el programa curl:
curl http://127.0.0.1:8080/api/v1/sms/?evento=6
El resultado es:</p>
<div class="highlight"><pre><span></span>{&quot;meta&quot;: {&quot;limit&quot;: 20, &quot;next&quot;: null, &quot;offset&quot;: 0, &quot;previous&quot;: null, &quot;total_count&quot;: 5}, &quot;objects&quot;: [{&quot;estatus&quot;:true, &quot;evento&quot;: &quot;/api/v1/evento/6/&quot;, &quot;id&quot;: &quot;21&quot;, &quot;mensaje&quot;: &quot;Esta es una prueba de sms&quot;, &quot;numcel&quot;: &quot;14225673531&quot;, &quot;resource_uri&quot;: &quot;/api/v1/sms/21/&quot;}, {&quot;estatus&quot;:true, &quot;evento&quot;: &quot;/api/v1/evento/6/&quot;,&quot;id&quot;: &quot;22&quot;, &quot;mensaje&quot;: &quot;Esta es una prueba de sms&quot;, &quot;numcel&quot;: &quot;142165673531&quot;, &quot;resource_uri&quot;: &quot;/api/v1/sms/22/&quot;}, {&quot;estatus&quot;: true, &quot;evento&quot;: &quot;/api/v1/evento/6/&quot;,&quot;id&quot;: &quot;23&quot;, &quot;mensaje&quot;: &quot;Esta es una prueba de sms&quot;, &quot;numcel&quot;: &quot;14265673531&quot;, &quot;resource_uri&quot;: &quot;/api/v1/sms/23/&quot;}, {&quot;estatus&quot;: true, &quot;evento&quot;: &quot;/api/v1/evento/6/&quot;, &quot;id&quot;: &quot;24&quot;, &quot;mensaje&quot;: &quot;Esta es una prueba de sms&quot;, &quot;numcel&quot;: &quot;14145673531&quot;, &quot;resource_uri&quot;: &quot;/api/v1/sms/24/&quot;}, {&quot;estatus&quot;: true, &quot;evento&quot;: &quot;/api/v1/evento/6/&quot;,&quot;id&quot;: &quot;25&quot;, &quot;mensaje&quot;: &quot;Esta es una prueba de sms&quot;, &quot;numcel&quot;: &quot;14245673531&quot;, &quot;resource_uri&quot;: &quot;/api/v1/sms/25/&quot;}]}
</pre></div>


<p>Por último se muestra la captura de pantalla de lo que se genera en el <code>djcelery</code>:</p>
<p><img alt="" src="./images/restfulapicondjangotastypieydjangocelery-5.png"></p>
<p>En el próximo artículo se mostrará el acceso a las tareas de <code>celery</code> desde el URL definido en <code>urls.py</code>.</p>
<h2></h2>
<p>¡Haz tu donativo!
Si te gustó el artículo puedes realizar un donativo con Bitcoin (BTC)
usando la billetera digital de tu preferencia a la siguiente
dirección: 17MtNybhdkA9GV3UNS6BTwPcuhjXoPrSzV</p>
<p>O Escaneando el código QR desde la billetera:</p>
<p><img alt="17MtNybhdkA9GV3UNS6BTwPcuhjXoPrSzV" src="./images/17MtNybhdkA9GV3UNS6BTwPcuhjXoPrSzV.png"></p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://ecrespo.github.io/tag/canaima.html">Canaima</a>
      <a href="https://ecrespo.github.io/tag/debian.html">Debian</a>
      <a href="https://ecrespo.github.io/tag/general.html">General</a>
      <a href="https://ecrespo.github.io/tag/linux.html">Linux</a>
      <a href="https://ecrespo.github.io/tag/python.html">Python</a>
      <a href="https://ecrespo.github.io/tag/ubuntu.html">Ubuntu</a>
      <a href="https://ecrespo.github.io/tag/django.html">Django</a>
    </p>
  </div>
  
<section>
  <p id="post-share-links">
    Share on:
    <a href="https://twitter.com/intent/tweet?text=Restful%20API%20con%20Django-tastypie%20y%20Django-Celery&url=https%3A//ecrespo.github.io/restful-api-con-django-tastypie-y-django-celery.html&hashtags=canaima,debian,general,linux,python,ubuntu,django" target="_blank" title="Share on Twitter">Twitter</a>
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//ecrespo.github.io/restful-api-con-django-tastypie-y-django-celery.html" target="_blank" title="Share on Facebook">Facebook</a>
    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A//ecrespo.github.io/restful-api-con-django-tastypie-y-django-celery.html&title=Restful%20API%20con%20Django-tastypie%20y%20Django-Celery&summary=Continuando%20con%20los%20art%C3%ADculos%20sobre%20django%2C%20en%20este%20caso%20se%20usar%C3%A1%20django-celery%20para%20env%C3%ADo%20de%20mensajes%20a%20un%20servidor%20kannel%20%28servidor%20sms%29%20y%20django-tastypie%20para%20mostrar%20el%20resultado%20por%20medio%20de%20API%20rest%20full%20con%20json.%0AEn%20los%20dos%20art%C3%ADculos%20anteriores%20Manejo%20de%20colas%20de%20RabbitMQ%20en%20django%20con%20django-celery%20%E2%80%A6&source=https%3A//ecrespo.github.io/restful-api-con-django-tastypie-y-django-celery.html" target="_blank" title="Share on LinkedIn">LinkedIn</a>
    <a href="mailto:?subject=Restful%20API%20con%20Django-tastypie%20y%20Django-Celery&amp;body=https%3A//ecrespo.github.io/restful-api-con-django-tastypie-y-django-celery.html" target="_blank" title="Share via Email">Email</a>
  </p>
</section>


  <div class="neighbors">
    <a class="btn float-left" href="https://ecrespo.github.io/configurando-un-sitio-estatico-con-flask.html" title="Configurando un sitio estático con flask">
      <i class="fa fa-angle-left"></i>     Previous Post

    </a>
    <a class="btn float-right" href="https://ecrespo.github.io/tarea-de-django-celery-desde-un-url.html" title="Tarea de Django-Celery desde un URL">
          Next Post
 <i class="fa fa-angle-right"></i>
    </a>
  </div>

  <div class="related-posts">
    <h4>    You might enjoy
</h4>
    <ul class="related-posts">
      <li><a href="https://ecrespo.github.io/urwid-libreria-ncurses-para-hacer-aplicaciones-de-texto-para-la-consola-parte-1.html">Urwid librería ncurses para hacer aplicaciones de texto para la consola (parte 1).</a></li>
      <li><a href="https://ecrespo.github.io/restful-api-con-django-tastypie.html">Restful API con Django-tastypie</a></li>
      <li><a href="https://ecrespo.github.io/crear-un-demonio-de-linux-con-python.html">Crear un demonio de Linux con Python</a></li>
      <li><a href="https://ecrespo.github.io/extraccion-de-datos-de-pagina-web-con-pyquery-y-python.html">Extracción de datos de página web con pyquery y Python</a></li>
      <li><a href="https://ecrespo.github.io/extraccion-de-datos-de-paginas-web-con-scrapemark-y-python.html">Extracción de datos de páginas web con Scrapemark y Python</a></li>
    </ul>
  </div>


<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'https://seraphto.disqus.com';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
        Please enable JavaScript to view comments.

</noscript>
<!-- End Disqus -->
</article>

    <footer>
<p>&copy;  2006</p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Página de Seraph ",
  "url" : "https://ecrespo.github.io",
  "image": "//s.gravatar.com/avatar/7fab2070e149e57fe99da94d7ccbad6b?s=120",
  "description": " Software Libre, Ciencia de Datos y Python"
}
</script>

</body>
</html>