<!doctype html>
<html lang="es" itemscope itemtype="http://schema.org/Person">
<head>
            <meta charset="utf-8">
        <!-- Site Meta Data -->
        <title>Cifrar el tráfico de DNS en Debian 9 Stretch (actualización 2017)</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="Ernesto Crespo">

        <link rel="shortcut icon" href="">

        <!-- schema.org -->
        <meta itemprop="name" content="Página de Seraph">
        <meta itemprop="image" content="">
        <meta itemprop="description" content="">

        <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700' rel='stylesheet' type='text/css'>
        <!-- Style Meta Data -->
        <link rel="stylesheet" href="https://ecrespo.github.io/theme/css/style.css" type="text/css"/>
        <link rel="stylesheet" href="https://ecrespo.github.io/theme/css/pygments.css" type="text/css"/>

        <!-- Feed Meta Data -->
            <link href="https://ecrespo.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
                  title="Página de Seraph ATOM Feed"/>

        <!-- Twitter Feed -->
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="">
        <meta name="twitter:image" content="">

    <meta name="twitter:creator" content="">
    <meta name="twitter:url" content="https://ecrespo.github.io/cifrar-el-trafico-de-dns-en-debian-9-stretch-actualizacion-2017.html">
    <meta name="twitter:title" content="Página de Seraph ~ Cifrar el tráfico de DNS en Debian 9 Stretch (actualización 2017)">
    <meta name="twitter:description" content="En el año 2012 preocupado por la lentitud y seguridad en las comunicaciones de las consultas de DNS escribí un artículo sobre DNSCrypt. Este artículo se basa en el artículo Comprobar que DNSCrypt funciona correctamente y cifra el tráfico . Para esa época la instalación se hacía bajando un archivo .deb …">

    <!-- Facebook Meta Data -->
    <meta property="og:title" content="Página de Seraph ~ Cifrar el tráfico de DNS en Debian 9 Stretch (actualización 2017)"/>
    <meta property="og:description" content="En el año 2012 preocupado por la lentitud y seguridad en las comunicaciones de las consultas de DNS escribí un artículo sobre DNSCrypt. Este artículo se basa en el artículo Comprobar que DNSCrypt funciona correctamente y cifra el tráfico . Para esa época la instalación se hacía bajando un archivo .deb …"/>
    <meta property="og:image" content=""/>
</head>

<body>
<!-- Sidebar -->
<aside>
    <!--<center><a href="https://ecrespo.github.io"><img id="avatar" src=""></a></center>-->
    <h1>Página de Seraph</h1>
    <br>


    <nav class="nav">
        <ul class="list-bare">

                <li><a class="nav__link" href="/archives.html">Archives</a></li>
                <li><a class="nav__link" href="/categories.html">Categories</a></li>
                <li><a class="nav__link" href="/tags.html">Tags</a></li>

                <li><a class="nav__link" href="https://ecrespo.github.io/pages/About.html">Acerca</a></li>
                <li><a class="nav__link" href="https://ecrespo.github.io/pages/Contacto.html">Contacto</a></li>

        </ul>
    </nav>

    <p class="social">
                <a href="https://medium.com/@_seraph1" target="_blank"><img
                        src="https://ecrespo.github.io/theme/images/icons/medium.png"></a>
                <a href="http://ve.linkedin.com/in/ernestocrespo" target="_blank"><img
                        src="https://ecrespo.github.io/theme/images/icons/linkedin.png"></a>
                <a href="https://github.com/ecrespo" target="_blank"><img
                        src="https://ecrespo.github.io/theme/images/icons/github.png"></a>
                <a href="https://google.com/+ErnestoCrespo" target="_blank"><img
                        src="https://ecrespo.github.io/theme/images/icons/google.png"></a>
                <a href="https://twitter.com/_seraph1" target="_blank"><img
                        src="https://ecrespo.github.io/theme/images/icons/twitter.png"></a>
                <a href="https://www.facebook.com/ernesto.crespo" target="_blank"><img
                        src="https://ecrespo.github.io/theme/images/icons/facebook.png"></a>
                <a href="https://gitlab.com/ecrespo" target="_blank"><img
                        src="https://ecrespo.github.io/theme/images/icons/gitlab.png"></a>
                <a href="https://soundcloud.com/ernesto-crespo" target="_blank"><img
                        src="https://ecrespo.github.io/theme/images/icons/soundcloud.png"></a>
                <a href="//www.seraph.to/feeds/all.atom.xml" target="_blank"><img
                        src="https://ecrespo.github.io/theme/images/icons/rss.png"></a>
            <a href="https://ecrespo.github.io/feeds/all.atom.xml" rel="alternate">
                <img src="https://ecrespo.github.io/theme/images/icons/rss.png"></a>
    </p>

        <h2>Categories</h2>
        <ul class="navbar">
                <li><a
                        href="https://ecrespo.github.io/category/accesibilidad.html">Accesibilidad</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/anuncio.html">Anuncio</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/anuncios.html">Anuncios</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/aplicacion-android.html">Aplicación Android</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/asterisk-debian-linux.html">Asterisk, Debian, Linux</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/charla.html">Charla</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/charla-python.html">Charla Python</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/debian-linux-mac-book.html">Debian, Linux, Mac Book</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/debian-maemo-nokia-n810-python.html">Debian, maemo, Nokia N810, Python</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/demostracion-aplicacion-para-android.html">Demostración Aplicación para Android</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/desarrollomovil.html">Desarrollo,Movil</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/evento.html">Evento</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/general.html">General</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/linux.html">Linux</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/linuxdebian.html">Linux,Debian</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/linuxdesarrollo.html">Linux,Desarrollo</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/linuxempaquetado.html">Linux,Empaquetado</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/linuxofimaticadesarrollo.html">Linux,Ofimatica,Desarrollo</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/movil-nokia.html">Movil, Nokia</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/nokia-n810.html">Nokia N810</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/nokia-n810-debian-maemo.html">Nokia N810 Debian Maemo</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/posts.html">posts</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/resumen-2010.html">Resumen 2010</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/sistemas-operativos.html">Sistemas Operativos</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/tutorial.html">Tutorial</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/tutorial-android.html">Tutorial Android</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/tutorial-de-arduino.html">Tutorial de Arduino</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/tutorial-de-data-science.html">Tutorial de Data Science</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/tutorial-de-docker.html">Tutorial de Docker</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/tutorial-de-integracion-continua.html">Tutorial de integración continua</a></li>
                <li class="active"><a
                        href="https://ecrespo.github.io/category/tutorial-de-linux.html">Tutorial de Linux</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/tutorial-de-python.html">Tutorial de Python</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/tutorial-de-python-en-android.html">Tutorial de Python en Android</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/tutorial-de-python-y-linux.html">Tutorial de Python y Linux</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/tutorial-de-python-y-pyqt.html">Tutorial de Python y PyQt</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/tutorial-debian-bsd-y-python.html">Tutorial Debian BSD y Python</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/tutorial-linux.html">Tutorial Linux</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/tutorial-linux-y-python.html">Tutorial Linux y Python</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/tutorial-python.html">Tutorial Python</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/tutorial-python-en-android.html">Tutorial Python en Android</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/tutorial-python-y-linux.html">Tutorial Python y Linux</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/tutorialdesarrollo.html">Tutorial,Desarrollo</a></li>
                <li><a
                        href="https://ecrespo.github.io/category/xml-rpcpython.html">XML-RPC,Python</a></li>
        </ul>


</aside>

<!-- Content -->
<article>
    <section id="content">
        <article>
            <h2 class="post_title post_detail"><a href="https://ecrespo.github.io/cifrar-el-trafico-de-dns-en-debian-9-stretch-actualizacion-2017.html" rel="bookmark"
                                                  title="Permalink to Cifrar el tráfico de DNS en Debian 9 Stretch (actualización 2017)">Cifrar el tráfico de DNS en Debian 9 Stretch (actualización 2017)</a></h2>
            <div class="entry-content blog-post">
                <p>En el año 2012 preocupado por la lentitud y seguridad en las comunicaciones de las consultas de DNS escribí un artículo sobre <a href="https://www.seraph.to/cifrar-el-trafico-de-dns-en-linux-con-dnscrypt-y-opendns.html">DNSCrypt</a>.</p>
<p>Este artículo se basa en el artículo <a href="https://geekland.eu/comprobar-el-funcionamiento-de-dnscrypt/">Comprobar que DNSCrypt funciona correctamente y cifra el tráfico</a> .</p>
<p>Para esa época la instalación se hacía bajando un archivo <code>.deb</code>, pero en Debian Stretch ya viene incorporado en los repositorios, así que para instalar es con un simple <code>apt-get</code>.</p>
<div class="highlight"><pre><span></span><code><span class="err">apt-get install dnscrypt-proxy dnscrypt-proxy-plugins</span>
</code></pre></div>

<p>Revisar que <code>DNSCrypt</code> esté activo:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># systemctl status dnscrypt-proxy.socket</span>
<span class="err">●</span> <span class="n">dnscrypt</span><span class="o">-</span><span class="n">proxy</span><span class="o">.</span><span class="n">socket</span> <span class="o">-</span> <span class="n">dnscrypt</span><span class="o">-</span><span class="n">proxy</span> <span class="n">listening</span> <span class="n">socket</span>
   <span class="n">Loaded</span><span class="p">:</span> <span class="n">loaded</span> <span class="p">(</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">systemd</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">dnscrypt</span><span class="o">-</span><span class="n">proxy</span><span class="o">.</span><span class="n">socket</span><span class="p">;</span> <span class="n">enabled</span><span class="p">;</span> <span class="n">vendor</span> <span class="n">preset</span><span class="p">:</span> <span class="n">enabled</span><span class="p">)</span>
   <span class="n">Active</span><span class="p">:</span> <span class="n">active</span> <span class="p">(</span><span class="n">running</span><span class="p">)</span> <span class="n">since</span> <span class="n">Sat</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">03</span> <span class="mi">00</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">02</span> <span class="o">-</span><span class="mi">04</span><span class="p">;</span> <span class="mi">18</span><span class="n">h</span> <span class="n">ago</span>
     <span class="n">Docs</span><span class="p">:</span> <span class="n">man</span><span class="p">:</span><span class="n">dnscrypt</span><span class="o">-</span><span class="n">proxy</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
   <span class="n">Listen</span><span class="p">:</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">2.1</span><span class="p">:</span><span class="mi">53</span> <span class="p">(</span><span class="n">Stream</span><span class="p">)</span>
           <span class="mf">127.0</span><span class="o">.</span><span class="mf">2.1</span><span class="p">:</span><span class="mi">53</span> <span class="p">(</span><span class="n">Datagram</span><span class="p">)</span>

<span class="n">jun</span> <span class="mi">03</span> <span class="mi">00</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">02</span> <span class="n">grievous</span> <span class="n">systemd</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">Listening</span> <span class="n">on</span> <span class="n">dnscrypt</span><span class="o">-</span><span class="n">proxy</span> <span class="n">listening</span> <span class="n">socket</span><span class="o">.</span>
</code></pre></div>

<p>Como se ve <code>DNSCrypt</code> está activo, para el caso de que no esté activo se ejecuta:</p>
<div class="highlight"><pre><span></span><code><span class="err"># systemctl start dnscrypt-proxy.socket</span>
</code></pre></div>

<p>Para que <code>DNSCrypt</code> se ejecute automáticamente se ejecuta:</p>
<div class="highlight"><pre><span></span><code><span class="err"># systemctl enable dnscrypt-proxy.socket</span>
</code></pre></div>

<p>La lista de servidores <code>DNSCrypt</code> lo pueden ver en <code>/usr/share/dnscrypt-proxy/dnscrypt-resolvers.csv</code> .  En la siguiente imagen se muestra algo del contenido del archivo: </p>
<p><img alt="" src="./images/cifrareltraficodednsendebian9stretchactualización2017-1.png"></p>
<p>Ahora se consulta el puerto y la IP que está usando <code>DNSCrypt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">systemd</span><span class="o">/</span><span class="k">system</span><span class="o">/</span><span class="n">sockets</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="n">wants</span><span class="o">/</span><span class="n">dnscrypt</span><span class="o">-</span><span class="n">proxy</span><span class="p">.</span><span class="n">socket</span><span class="w"></span>
<span class="o">[</span><span class="n">Unit</span><span class="o">]</span><span class="w"></span>
<span class="n">Description</span><span class="o">=</span><span class="n">dnscrypt</span><span class="o">-</span><span class="n">proxy</span><span class="w"> </span><span class="n">listening</span><span class="w"> </span><span class="n">socket</span><span class="w"></span>
<span class="n">Documentation</span><span class="o">=</span><span class="nl">man</span><span class="p">:</span><span class="n">dnscrypt</span><span class="o">-</span><span class="n">proxy</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="w"></span>
<span class="n">Wants</span><span class="o">=</span><span class="n">dnscrypt</span><span class="o">-</span><span class="n">proxy</span><span class="o">-</span><span class="n">resolvconf</span><span class="p">.</span><span class="n">service</span><span class="w"></span>

<span class="o">[</span><span class="n">Socket</span><span class="o">]</span><span class="w"></span>
<span class="n">ListenStream</span><span class="o">=</span><span class="mf">127.0.2.1</span><span class="err">:</span><span class="mi">53</span><span class="w"></span>
<span class="n">ListenDatagram</span><span class="o">=</span><span class="mf">127.0.2.1</span><span class="err">:</span><span class="mi">53</span><span class="w"></span>

<span class="o">[</span><span class="n">Install</span><span class="o">]</span><span class="w"></span>

<span class="n">WantedBy</span><span class="o">=</span><span class="n">sockets</span><span class="p">.</span><span class="n">target</span><span class="w"></span>
</code></pre></div>

<p>La dirección IP que está usando <code>DNSCrypt</code> es la 127.0.2.1 y el puerto 53.</p>
<p>Este archivo se modifica si se está usano <code>SystemD</code>, para el caso de usar <code>init.d</code> se modifica el archivo que se describe a continuación.</p>
<p>Se edita el archivo <code>/etc/dnscrypt-proxy/dnscrypt-proxy.conf</code> :</p>
<div class="highlight"><pre><span></span><code><span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">dnscrypt</span><span class="o">-</span><span class="n">proxy</span><span class="o">/</span><span class="n">dnscrypt</span><span class="o">-</span><span class="n">proxy</span><span class="p">.</span><span class="n">conf</span>

<span class="o">#</span> <span class="n">cat</span> <span class="n">dnscrypt</span><span class="o">-</span><span class="n">proxy</span><span class="p">.</span><span class="n">conf</span> 
<span class="o">#</span> <span class="n">A</span> <span class="k">more</span> <span class="n">comprehensive</span> <span class="n">example</span> <span class="n">config</span> <span class="n">can</span> <span class="n">be</span> <span class="k">found</span> <span class="k">in</span>
<span class="o">#</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="k">share</span><span class="o">/</span><span class="n">doc</span><span class="o">/</span><span class="n">dnscrypt</span><span class="o">-</span><span class="n">proxy</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">dnscrypt</span><span class="o">-</span><span class="n">proxy</span><span class="p">.</span><span class="n">conf</span>

<span class="n">ResolverName</span> <span class="n">random</span>
<span class="n">Daemonize</span> <span class="n">yes</span>

<span class="o">#</span> <span class="n">LocalAddress</span> <span class="k">only</span> <span class="n">applies</span> <span class="k">to</span> <span class="n">users</span> <span class="k">of</span> <span class="n">the</span> <span class="n">init</span> <span class="n">script</span><span class="p">.</span> <span class="n">systemd</span> <span class="n">users</span> <span class="n">must</span>
<span class="o">#</span> <span class="n">change</span> <span class="n">the</span> <span class="n">dnscrypt</span><span class="o">-</span><span class="n">proxy</span><span class="p">.</span><span class="n">socket</span> <span class="n">file</span><span class="p">.</span>
<span class="n">LocalAddress</span> <span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="mi">1</span><span class="p">:</span><span class="mi">53</span>
</code></pre></div>

<p>Con la opción <code>random</code> garantiza que se use cualquier servidor de <code>DNSCrypt</code> de la lista ya mencionada.</p>
<p>Al levantar el servicio de <code>DNSCrypt</code> este cambia la configuración de <code>/etc/resolv.conf</code> para que use la IP 127.0.2.1, a continuación se muestra el contenido del archivo </p>
<div class="highlight"><pre><span></span><code><span class="o">#</span> <span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">resolv</span><span class="p">.</span><span class="n">conf</span>

<span class="o">#</span> <span class="k">Generated</span> <span class="k">by</span> <span class="n">resolvconf</span>
<span class="n">nameserver</span> <span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="mi">1</span>
</code></pre></div>

<p>Al iniciar el servicio se puede revisar el log de <code>syslog</code> para ver si funciona el servicio:</p>
<p><img alt="" src="./images/cifrareltraficodednsendebian9stretchactualización2017-2.png"></p>
<p>Como se puede ver en el <code>syslog</code>, al inicio el servicio espera por un certificado digital y luego es que empieza a funcionar. </p>
<p>Al consultar con el comando <code>host</code> se tiene:</p>
<div class="highlight"><pre><span></span><code><span class="err">host www.google.com</span>
<span class="err">www.google.com has address 216.58.209.68</span>
<span class="err">www.google.com has IPv6 address 2a00:1450:401b:801::2004</span>
</code></pre></div>

<p>Ahora se instalarán unas herramientas de consultas:</p>
<div class="highlight"><pre><span></span><code><span class="err">apt-get install dnsutils </span>
</code></pre></div>

<p>Se realiza una consulta con el comando <code>dig</code>: </p>
<div class="highlight"><pre><span></span><code><span class="nt">dig</span> <span class="nt">www</span><span class="p">.</span><span class="nc">google</span><span class="p">.</span><span class="nc">com</span>

<span class="o">;</span> <span class="o">&lt;&lt;&gt;&gt;</span> <span class="nt">DiG</span> <span class="nt">9</span><span class="p">.</span><span class="nc">10</span><span class="p">.</span><span class="nc">3-P4-Debian</span> <span class="o">&lt;&lt;&gt;&gt;</span> <span class="nt">www</span><span class="p">.</span><span class="nc">google</span><span class="p">.</span><span class="nc">com</span>
<span class="o">;;</span> <span class="nt">global</span> <span class="nt">options</span><span class="o">:</span> <span class="o">+</span><span class="nt">cmd</span>
<span class="o">;;</span> <span class="nt">Got</span> <span class="nt">answer</span><span class="o">:</span>
<span class="o">;;</span> <span class="nt">-</span><span class="o">&gt;&gt;</span><span class="nt">HEADER</span><span class="o">&lt;&lt;</span><span class="nt">-</span> <span class="nt">opcode</span><span class="o">:</span> <span class="nt">QUERY</span><span class="o">,</span> <span class="nt">status</span><span class="o">:</span> <span class="nt">NOERROR</span><span class="o">,</span> <span class="nt">id</span><span class="o">:</span> <span class="nt">6930</span>
<span class="o">;;</span> <span class="nt">flags</span><span class="o">:</span> <span class="nt">qr</span> <span class="nt">rd</span> <span class="nt">ra</span><span class="o">;</span> <span class="nt">QUERY</span><span class="o">:</span> <span class="nt">1</span><span class="o">,</span> <span class="nt">ANSWER</span><span class="o">:</span> <span class="nt">1</span><span class="o">,</span> <span class="nt">AUTHORITY</span><span class="o">:</span> <span class="nt">0</span><span class="o">,</span> <span class="nt">ADDITIONAL</span><span class="o">:</span> <span class="nt">1</span>

<span class="o">;;</span> <span class="nt">OPT</span> <span class="nt">PSEUDOSECTION</span><span class="o">:</span>
<span class="o">;</span> <span class="nt">EDNS</span><span class="o">:</span> <span class="nt">version</span><span class="o">:</span> <span class="nt">0</span><span class="o">,</span> <span class="nt">flags</span><span class="o">:;</span> <span class="nt">udp</span><span class="o">:</span> <span class="nt">4096</span>
<span class="o">;;</span> <span class="nt">QUESTION</span> <span class="nt">SECTION</span><span class="o">:</span>
<span class="o">;</span><span class="nt">www</span><span class="p">.</span><span class="nc">google</span><span class="p">.</span><span class="nc">com</span><span class="o">.</span>   <span class="nt">IN</span> <span class="nt">A</span>

<span class="o">;;</span> <span class="nt">ANSWER</span> <span class="nt">SECTION</span><span class="o">:</span>
<span class="nt">www</span><span class="p">.</span><span class="nc">google</span><span class="p">.</span><span class="nc">com</span><span class="o">.</span>  <span class="nt">7</span> <span class="nt">IN</span> <span class="nt">A</span> <span class="nt">216</span><span class="p">.</span><span class="nc">58</span><span class="p">.</span><span class="nc">209</span><span class="p">.</span><span class="nc">68</span>

<span class="o">;;</span> <span class="nt">Query</span> <span class="nt">time</span><span class="o">:</span> <span class="nt">266</span> <span class="nt">msec</span>
<span class="o">;;</span> <span class="nt">SERVER</span><span class="o">:</span> <span class="nt">127</span><span class="p">.</span><span class="nc">0</span><span class="p">.</span><span class="nc">2</span><span class="p">.</span><span class="nc">1</span><span class="p">#</span><span class="nn">53</span><span class="o">(</span><span class="nt">127</span><span class="p">.</span><span class="nc">0</span><span class="p">.</span><span class="nc">2</span><span class="p">.</span><span class="nc">1</span><span class="o">)</span>
<span class="o">;;</span> <span class="nt">WHEN</span><span class="o">:</span> <span class="nt">Sat</span> <span class="nt">Jun</span> <span class="nt">03</span> <span class="nt">20</span><span class="p">:</span><span class="nd">26</span><span class="p">:</span><span class="nd">08</span> <span class="nt">-04</span> <span class="nt">2017</span>
<span class="o">;;</span> <span class="nt">MSG</span> <span class="nt">SIZE</span>  <span class="nt">rcvd</span><span class="o">:</span> <span class="nt">59</span>
</code></pre></div>

<p>Para verificar el funcionamiento del cifrado en <code>DNSCrypt</code> se usará <code>wireshark-gtk</code>, primero se instala y luego se ejecuta:</p>
<div class="highlight"><pre><span></span><code><span class="err">#apt-get install wireshark wireshark-gtk</span>
</code></pre></div>

<p>Para averiguar la IP del servidor <code>DNSCrypt</code> que se está usando se usa  <code>dnsleaktest</code>, al abrir la página muestra que la IP del equipo se encuentra en Barquisimeto, Venezuela y la IP es 186.185.180.136.</p>
<p><img alt="" src="./images/cifrareltraficodednsendebian9stretchactualización2017-3.png"></p>
<p>Se le da click a  <code>standard test</code>:</p>
<p><img alt="" src="./images/cifrareltraficodednsendebian9stretchactualización2017-4.png"></p>
<p>La IP del servidor es 81.2.237.32.</p>
<p>Se inicia <code>wireshark</code> capturando paquetes de la interface wlp1s0 que es ahora como se llama wlan0 en Debian Strech. Se inicia la captura de paquetes y se filtra ip.addr == 81.2.237.32. El resultado se muestra a continuación: </p>
<p><img alt="" src="./images/cifrareltraficodednsendebian9stretchactualización2017-5.png"></p>
<p>El protocolo que se usa en la comunicación es <a href="https://es.wikipedia.org/wiki/QUIC">QUIC</a> el cual es un experimental que cifra la comunicación. Se selecciona el primer paquete y con el botón derecho se le da clic a follow udp steam obteniendo lo que se muestra en la siguiente figura:</p>
<p><img alt="" src="./images/cifrareltraficodednsendebian9stretchactualización2017-6.png"></p>
<p>Al ejecutar esa acción se realiza la construcción de los diferentes paquetes en este caso de UDP en formato crudo, como se puede ver la comunicación no muestra información en texto plato. </p>
<h2></h2>
<p>¡Haz tu donativo!
Si te gustó el artículo puedes realizar un donativo con Bitcoin (BTC)
usando la billetera digital de tu preferencia a la siguiente
dirección: 17MtNybhdkA9GV3UNS6BTwPcuhjXoPrSzV</p>
<p>O Escaneando el código QR desde la billetera:</p>
<p><img alt="17MtNybhdkA9GV3UNS6BTwPcuhjXoPrSzV" src="./images/17MtNybhdkA9GV3UNS6BTwPcuhjXoPrSzV.png"></p>
            </div>
            <div class="post_list">
                <span>By </span>
                <a href="https://ecrespo.github.io/author/ernesto-crespo.html">@Ernesto Crespo</a>
                <span> in </span>
                <span class="post_category"><a href="https://ecrespo.github.io/category/tutorial-de-linux.html" rel="bookmark"
                                               title="Permalink to Tutorial de Linux">[ Tutorial de Linux ]</a></span>
                <span class="post_date">sáb 03 junio 2017</span>
                <div><span>Tags : </span>
                            <span><a href="https://ecrespo.github.io/tag/linux.html">#Linux, </a></span>
                            <span><a href="https://ecrespo.github.io/tag/debian.html">#Debian, </a></span>
                            <span><a href="https://ecrespo.github.io/tag/dns.html">#DNS, </a></span>
                            <span><a href="https://ecrespo.github.io/tag/dnscrypt.html">#DNSCrypt, </a></span>
                </div>

                <div class="entry-social">
                    <span class="twitter"><a target="_blank" rel="nofollow"
                                             onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=400,width=700');return false;"
                                             title="Twitter"
                                             href="https://twitter.com/share?url=https://ecrespo.github.io/cifrar-el-trafico-de-dns-en-debian-9-stretch-actualizacion-2017.html&text=Cifrar el tráfico de DNS en Debian 9 Stretch (actualización 2017)&via="><img
                            src="https://ecrespo.github.io/theme/images/icons/twitter-s.png"></a></span>

                    <span class="gplus"><a target="_blank" title="Google +"
                                           href="https://plus.google.com/share?url=https://ecrespo.github.io/cifrar-el-trafico-de-dns-en-debian-9-stretch-actualizacion-2017.html&hl=fr"
                                           rel="nofollow"
                                           onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=450,width=650');return false;"><img
                            src="https://ecrespo.github.io/theme/images/icons/google-s.png"></a></span>

                    <span class="facebook"><a target="_blank" title="Facebook" rel="nofollow"
                                              onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=500,width=700');return false;"
                                              href="https://www.facebook.com/sharer.php?u=https://ecrespo.github.io/cifrar-el-trafico-de-dns-en-debian-9-stretch-actualizacion-2017.html&t=Cifrar el tráfico de DNS en Debian 9 Stretch (actualización 2017)"><img
                            src="https://ecrespo.github.io/theme/images/icons/facebook-s.png"></a></span>

                    <a target="_blank" title="Linkedin"
                       href="https://www.linkedin.com/shareArticle?mini=true&url=https://ecrespo.github.io/cifrar-el-trafico-de-dns-en-debian-9-stretch-actualizacion-2017.html&title=Cifrar el tráfico de DNS en Debian 9 Stretch (actualización 2017)"
                       rel="nofollow"
                       onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=450,width=650');return false;"><img
                            src="https://ecrespo.github.io/theme/images/icons/linkedin-s.png"></a>

                    <span class="mail"><a
                            href="mailto:?subject=Cifrar el tráfico de DNS en Debian 9 Stretch (actualización 2017)&amp;body=Viens découvrir un article à propos de [Cifrar el tráfico de DNS en Debian 9 Stretch (actualización 2017)] sur le site de Ernesto Crespo. https://ecrespo.github.io/cifrar-el-trafico-de-dns-en-debian-9-stretch-actualizacion-2017.html"
                            title="Share by Email" target="_blank"><img
                            src="https://ecrespo.github.io/theme/images/icons/mail-s.png"></a></span>
                </div>
            </div>
                <div class="comments">
                    <h2>Comments !</h2>
                    <div id="disqus_thread"></div>
                    <script type="text/javascript">
                        var disqus_identifier = "cifrar-el-trafico-de-dns-en-debian-9-stretch-actualizacion-2017.html";
                        (function () {
                            var dsq = document.createElement('script');
                            dsq.type = 'text/javascript';
                            dsq.async = true;
                            dsq.src = 'https://https://seraphto.disqus.com.disqus.com/embed.js';
                            (document.getElementsByTagName('head')[0] ||
                            document.getElementsByTagName('body')[0]).appendChild(dsq);
                        })();
                    </script>
                </div>
        </article>
    </section>
</article>

<!-- Footer -->
    <footer>
        <p>
            Blog powered by <a href="http://getpelican.com/">Pelican</a>,
            which takes great advantage of <a href="http://python.org">Python</a>.
            Theme <a href="https://github.com/parbhat/pelican-blue">Pelican-Blue</a> by <a
                href="https://parbhatpuri.com/">@parbhat</a>.
        </p>
    </footer>

    <!-- Analytics -->
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-131517246-1']);
        _gaq.push(['_trackPageview']);
        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>

</body>
</html>