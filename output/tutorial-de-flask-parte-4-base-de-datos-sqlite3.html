
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://ecrespo.github.io/theme/stylesheet/style.min.css">


    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="https://ecrespo.github.io/theme/pygments/monokai.min.css">


  <link rel="stylesheet" type="text/css" href="https://ecrespo.github.io/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://ecrespo.github.io/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://ecrespo.github.io/theme/font-awesome/css/solid.css">


    <link href="https://ecrespo.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Página de Seraph Atom">



<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-131517246-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->
    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#e5e5ff">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#e5e5ff">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Microsoft EDGE -->
    <meta name="msapplication-TileColor" content="#e5e5ff">

<meta name="author" content="Ernesto Crespo" />
<meta name="description" content="Continuando con la serie de tutoriales sobre Flask, en este caso se tocará el tema de base de datos, usando sqlite3. Este artículo se basa en el artículo en Inglés de The Flask Mega tutorial, Part IV: Database. Los artículos anteriores son: Tutorial de Flask parte 1. Tutorial de Flask …" />
<meta name="keywords" content="Python, Flask, Docker, Sqlite3">


<meta property="og:site_name" content="Página de Seraph"/>
<meta property="og:title" content="Tutorial de Flask parte 4 (base de datos sqlite3)"/>
<meta property="og:description" content="Continuando con la serie de tutoriales sobre Flask, en este caso se tocará el tema de base de datos, usando sqlite3. Este artículo se basa en el artículo en Inglés de The Flask Mega tutorial, Part IV: Database. Los artículos anteriores son: Tutorial de Flask parte 1. Tutorial de Flask …"/>
<meta property="og:locale" content="es_VE"/>
<meta property="og:url" content="https://ecrespo.github.io/tutorial-de-flask-parte-4-base-de-datos-sqlite3.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2016-09-12 09:00:00-04:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://ecrespo.github.io/author/ernesto-crespo.html">
<meta property="article:section" content="Tutorial Python"/>
<meta property="article:tag" content="Python"/>
<meta property="article:tag" content="Flask"/>
<meta property="article:tag" content="Docker"/>
<meta property="article:tag" content="Sqlite3"/>
<meta property="og:image" content="//s.gravatar.com/avatar/7fab2070e149e57fe99da94d7ccbad6b?s=120">

  <title>Página de Seraph &ndash; Tutorial de Flask parte 4 (base de datos sqlite3)</title>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "pub-0261001661746989",
      enable_page_level_ads: true
    });
  </script>
</head>
<body class="light-theme">
  <aside>
    <div>
      <a href="https://ecrespo.github.io">
        <img src="//s.gravatar.com/avatar/7fab2070e149e57fe99da94d7ccbad6b?s=120" alt="Ernesto Crespo" title="Ernesto Crespo">
      </a>

      <h1>
        <a href="https://ecrespo.github.io">Ernesto Crespo</a>
      </h1>

<p>Data Scientist </p>

      <nav>
        <ul class="list">


              <li>
                <a target="_self"
                   href="https://ecrespo.github.io/pages/About.html#About">
                  Acerca
                </a>
              </li>
              <li>
                <a target="_self"
                   href="https://ecrespo.github.io/pages/Contacto.html#Contacto">
                  Contacto
                </a>
              </li>

        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-medium" href="https://medium.com/@_seraph1" target="_blank">
              <i class="fab fa-medium"></i>
            </a>
          </li>
          <li>
            <a  class="sc-linkedin" href="http://ve.linkedin.com/in/ernestocrespo" target="_blank">
              <i class="fab fa-linkedin"></i>
            </a>
          </li>
          <li>
            <a  class="sc-github" href="https://github.com/ecrespo" target="_blank">
              <i class="fab fa-github"></i>
            </a>
          </li>
          <li>
            <a  class="sc-google" href="https://google.com/+ErnestoCrespo" target="_blank">
              <i class="fab fa-google"></i>
            </a>
          </li>
          <li>
            <a  class="sc-twitter" href="https://twitter.com/_seraph1" target="_blank">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
          <li>
            <a  class="sc-facebook" href="https://www.facebook.com/ernesto.crespo" target="_blank">
              <i class="fab fa-facebook"></i>
            </a>
          </li>
          <li>
            <a  class="sc-gitlab" href="https://gitlab.com/ecrespo" target="_blank">
              <i class="fab fa-gitlab"></i>
            </a>
          </li>
          <li>
            <a  class="sc-soundcloud" href="https://soundcloud.com/ernesto-crespo" target="_blank">
              <i class="fab fa-soundcloud"></i>
            </a>
          </li>
          <li>
            <a  class="sc-rss" href="//www.seraph.to/feeds/all.atom.xml" target="_blank">
              <i class="fas fa-rss"></i>
            </a>
          </li>
      </ul>
    </div>

      <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
      <ins class="adsbygoogle ads-aside"
           data-ad-client="pub-0261001661746989"
           data-ad-slot="1234561"></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
  </aside>
  <main>
      <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
      <ins class="adsbygoogle ads-responsive"
           data-ad-client="pub-0261001661746989"
           data-ad-slot="1234562"></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>

    <nav>
      <a href="https://ecrespo.github.io">Home</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="https://ecrespo.github.io/feeds/all.atom.xml">Atom</a>

    </nav>

<article class="single">
  <header>
      
    <h1 id="tutorial-de-flask-parte-4-base-de-datos-sqlite3">Tutorial de Flask parte 4 (base de datos sqlite3)</h1>
    <p>
      Posted on lun 12 septiembre 2016 in <a href="https://ecrespo.github.io/category/tutorial-python.html">Tutorial Python</a>

        &#8226; 6 min read
    </p>
  </header>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle ads-responsive"
         data-ad-client="pub-0261001661746989"
         data-ad-slot="1234565"></ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>

  <div>
    <p>Continuando con la serie de tutoriales sobre Flask, en este caso se tocará el tema de base de datos, usando sqlite3. </p>
<p>Este artículo se basa en el artículo en Inglés de <a href="https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iv-database">The Flask Mega tutorial, Part IV: Database.</a></p>
<p>Los artículos anteriores son:</p>
<ol>
<li>
<p><a href="https://www.seraph.to/tutorial-de-flask-parte-1.html#tutorial-de-flask-parte-1">Tutorial de Flask parte 1.</a></p>
</li>
<li>
<p><a href="https://www.seraph.to/tutorial-de-flask-parte-2-plantillas-html.html#tutorial-de-flask-parte-2-plantillas-html">Tutorial de Flask parte 2 (plantilla html).</a></p>
</li>
<li>
<p><a href="https://www.seraph.to/tutorial-de-flask-parte-3-formulario-web.html#tutorial-de-flask-parte-3-formulario-web">Tutorial de Flask parte 3 (formulario web).</a></p>
</li>
</ol>
<div class="highlight"><pre><span class="code-line"><span></span><code>tutorial-flask/</span>
<span class="code-line">├── app</span>
<span class="code-line">│   ├── forms.py</span>
<span class="code-line">│   ├── __init__.py</span>
<span class="code-line">│   ├── models.py</span>
<span class="code-line">│   ├── templates</span>
<span class="code-line">│   │   ├── base.html</span>
<span class="code-line">│   │   ├── index.html</span>
<span class="code-line">│   │   └── login.html</span>
<span class="code-line">│   └── views.py</span>
<span class="code-line">├── config.py</span>
<span class="code-line">├── db_create.py</span>
<span class="code-line">├── db_downgrade.py</span>
<span class="code-line">├── db_migrate.py</span>
<span class="code-line">├── db_upgrade.py</span>
<span class="code-line">├── docker-compose.yml</span>
<span class="code-line">├── Dockerfile</span>
<span class="code-line">├── README.md</span>
<span class="code-line">├── run.py</span>
<span class="code-line">└── tmp</span>
<span class="code-line"></code></pre></div>

<p>Los archivos nuevos o modificados son los siguientes:<br>
- <code>config.py</code>.<br>
- <code>db_create.py</code>: Script para crear la base de datos.<br>
- <code>db_migrate.py</code>: Script para migrar la base de datos.<br>
- <code>db_upgrade.py</code>: Script para actualizar la base de datos.<br>
- <code>db_downgrade.py</code>: Script para revertir actulización de la base de datos.<br>
- <code>__init__.py</code><br>
- <code>models.py</code>: Módulo donde se define las tablas de la base de datos.  </p>
<p>Archivo <code>config.py</code>: </p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="c1">#Se importa os</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="kn">import</span> <span class="nn">os</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#Se define el directorio base del proyecto</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">basedir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#Se habilita CSRF</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">CSRF_ENABLED</span> <span class="o">=</span> <span class="kc">True</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#Se define la clave secreta</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s1">&#39;pruea&#39;</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">PROVEEDORES_OPENID</span> <span class="o">=</span> <span class="p">[</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">    <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Google&#39;</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;https://www.google.com/accounts/o8/id&#39;</span><span class="p">},</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">    <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Yahoo&#39;</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;https://me.yahoo.com&#39;</span><span class="p">}]</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#Se define el uri de la base de datos sqlite app.db</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">SQLALCHEMY_DATABASE_URI</span> <span class="o">=</span> <span class="s1">&#39;sqlite:///&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basedir</span><span class="p">,</span> <span class="s1">&#39;app.db&#39;</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#Se define el repositorio para migracion de la base de datos app.db</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">SQLALCHEMY_MIGRATE_REPO</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basedir</span><span class="p">,</span> <span class="s1">&#39;db_repository&#39;</span><span class="p">)</span></span>
<span class="code-line"></code></pre></div>

<p>Archivo <code>__init__.py</code>:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="c1">#Se importa Flask</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#Se importa SQLALchemy</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#from flask.ext.sqlalchemy import SQLAlchemy</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">flask_sqlalchemy</span> <span class="kn">import</span> <span class="n">SQLAlchemy</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#Se crea la instancia de flask</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#Se define la configuracion</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="s1">&#39;config&#39;</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#SE instancia la base de datos</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">db</span> <span class="o">=</span> <span class="n">SQLAlchemy</span><span class="p">(</span><span class="n">app</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#Se importa views y models de app</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">views</span><span class="p">,</span> <span class="n">models</span></span>
<span class="code-line"></code></pre></div>

<p>Archivo <code>models.py</code>:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="c1">#de app se importa db</span></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">db</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#Se crea la tabla User que hereda de db.Model</span></span>
<span class="code-line"><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span></span>
<span class="code-line">    <span class="c1">#Se crea la columna id como clave primaria e integer</span></span>
<span class="code-line">    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span class="code-line">    <span class="c1">#Se crea la columna nickname como string de tamagn 64, como unico.</span></span>
<span class="code-line">    <span class="n">usuario</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span class="code-line">    <span class="c1">#Columna correo, de 120 de tamagno del string y unico.</span></span>
<span class="code-line">    <span class="n">correo</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">120</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span class="code-line">    <span class="c1">#Posts. que tiene relacion con la clase Post (tabla post),</span></span>
<span class="code-line">    <span class="n">posts</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;Post&#39;</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="s1">&#39;dynamic&#39;</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></span>
<span class="code-line">        <span class="k">return</span> <span class="s1">&#39;&lt;User </span><span class="si">%r</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">usuario</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#Tabla Post que hereda de model</span></span>
<span class="code-line"><span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span></span>
<span class="code-line">    <span class="c1">#Se crea el id del post como entero y clave primaria</span></span>
<span class="code-line">    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span class="code-line">    <span class="c1">#Se crea la columna body como string de 140 caracteres</span></span>
<span class="code-line">    <span class="n">cuerpo</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">140</span><span class="p">))</span></span>
<span class="code-line">    <span class="c1">#Se define la marca de tiempo.</span></span>
<span class="code-line">    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">DateTime</span><span class="p">)</span></span>
<span class="code-line">    <span class="c1">#Se define el id del usuario, es una clave foranea de la tabla usuario</span></span>
<span class="code-line">    <span class="c1">#Columna id.</span></span>
<span class="code-line">    <span class="n">user_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;user.id&#39;</span><span class="p">))</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></span>
<span class="code-line">        <span class="k">return</span> <span class="s1">&#39;&lt;Post </span><span class="si">%r</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cuerpo</span><span class="p">)</span></span>
<span class="code-line"></code></pre></div>

<p>Archivo <code>db_create.py</code>: </p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="ch">#!/usr/bin/env python</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#de migrate.versioning se importa api</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">migrate.versioning</span> <span class="kn">import</span> <span class="n">api</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#De config se importa el uri</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">SQLALCHEMY_DATABASE_URI</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#De config se importa el repo de migrate</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">SQLALCHEMY_MIGRATE_REPO</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#De app se importa db</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">db</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#Se importa os.path</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="kn">import</span> <span class="nn">os.path</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#Se crea la base de datos.</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">db</span><span class="o">.</span><span class="n">create_all</span><span class="p">()</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#Si el directorio del migrate no existe se crea y se usa,</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#Si no se usa. </span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">SQLALCHEMY_MIGRATE_REPO</span><span class="p">):</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">api</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">SQLALCHEMY_MIGRATE_REPO</span><span class="p">,</span> <span class="s1">&#39;database repository&#39;</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">api</span><span class="o">.</span><span class="n">version_control</span><span class="p">(</span><span class="n">SQLALCHEMY_DATABASE_URI</span><span class="p">,</span> <span class="n">SQLALCHEMY_MIGRATE_REPO</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">else</span><span class="p">:</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">api</span><span class="o">.</span><span class="n">version_control</span><span class="p">(</span><span class="n">SQLALCHEMY_DATABASE_URI</span><span class="p">,</span> <span class="n">SQLALCHEMY_MIGRATE_REPO</span><span class="p">,</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">                        <span class="n">api</span><span class="o">.</span><span class="n">version</span><span class="p">(</span><span class="n">SQLALCHEMY_MIGRATE_REPO</span><span class="p">))</span></span>
<span class="code-line"></code></pre></div>

<p>Archivo <code>db_migrate.py</code>:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="ch">#!/usr/bin/env python</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#se importa api.</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">migrate.versioning</span> <span class="kn">import</span> <span class="n">api</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#Se importa el uri y el migrate.</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">SQLALCHEMY_DATABASE_URI</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">SQLALCHEMY_MIGRATE_REPO</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#se define la version de la db para las migraciones.</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">v</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">db_version</span><span class="p">(</span><span class="n">SQLALCHEMY_DATABASE_URI</span><span class="p">,</span> <span class="n">SQLALCHEMY_MIGRATE_REPO</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#Se baja una version.</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">api</span><span class="o">.</span><span class="n">downgrade</span><span class="p">(</span><span class="n">SQLALCHEMY_DATABASE_URI</span><span class="p">,</span> <span class="n">SQLALCHEMY_MIGRATE_REPO</span><span class="p">,</span> <span class="n">v</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#Se vuelva a definir el uri y migrate de la vesion.</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">v</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">db_version</span><span class="p">(</span><span class="n">SQLALCHEMY_DATABASE_URI</span><span class="p">,</span> <span class="n">SQLALCHEMY_MIGRATE_REPO</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#Se muestra en pantalla la version actual.</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Current database version: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span></span>
<span class="code-line"></code></pre></div>

<p>Archivo <code>db_upgrate.py</code>:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="ch">#!/usr/bin/env python</span></span>
<span class="code-line"><span class="c1">#Se importa api.</span></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">migrate.versioning</span> <span class="kn">import</span> <span class="n">api</span></span>
<span class="code-line"><span class="c1">#De config se importa URI y el repo.</span></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">SQLALCHEMY_DATABASE_URI</span></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">SQLALCHEMY_MIGRATE_REPO</span></span>
<span class="code-line"><span class="c1">#Se actualiza el api.</span></span>
<span class="code-line"><span class="n">api</span><span class="o">.</span><span class="n">upgrade</span><span class="p">(</span><span class="n">SQLALCHEMY_DATABASE_URI</span><span class="p">,</span> <span class="n">SQLALCHEMY_MIGRATE_REPO</span><span class="p">)</span></span>
<span class="code-line"><span class="c1">#Se define la version del api.</span></span>
<span class="code-line"><span class="n">v</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">db_version</span><span class="p">(</span><span class="n">SQLALCHEMY_DATABASE_URI</span><span class="p">,</span> <span class="n">SQLALCHEMY_MIGRATE_REPO</span><span class="p">)</span></span>
<span class="code-line"><span class="c1">#Se muestra la nueva version.</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Current database version: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span></span>
<span class="code-line"></code></pre></div>

<p>Archivo <code>db_downgrade.py</code>:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="ch">#!/usr/bin/env python</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#se importa api.</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">migrate.versioning</span> <span class="kn">import</span> <span class="n">api</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#Se importa el uri y el migrate.</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">SQLALCHEMY_DATABASE_URI</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">SQLALCHEMY_MIGRATE_REPO</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#se define la version de la db para las migraciones.</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">v</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">db_version</span><span class="p">(</span><span class="n">SQLALCHEMY_DATABASE_URI</span><span class="p">,</span> <span class="n">SQLALCHEMY_MIGRATE_REPO</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#Se baja una version.</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">api</span><span class="o">.</span><span class="n">downgrade</span><span class="p">(</span><span class="n">SQLALCHEMY_DATABASE_URI</span><span class="p">,</span> <span class="n">SQLALCHEMY_MIGRATE_REPO</span><span class="p">,</span> <span class="n">v</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#Se vuelva a definir el uri y migrate de la vesion.</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">v</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">db_version</span><span class="p">(</span><span class="n">SQLALCHEMY_DATABASE_URI</span><span class="p">,</span> <span class="n">SQLALCHEMY_MIGRATE_REPO</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#Se muestra en pantalla la version actual.</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Current database version: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span></span>
<span class="code-line"></code></pre></div>

<p>Construir la imagen docker por medio de <code>docker-compose</code>:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>docker-compose build</span>
<span class="code-line"></code></pre></div>

<p>Ahora toca ejecutar el contenedor:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>docker-compose up</span>
<span class="code-line">Creating tutorialflask_web_1</span>
<span class="code-line">Attaching to tutorialflask_web_1</span>
<span class="code-line">web_1  |  * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)</span>
<span class="code-line">web_1  |  * Restarting with stat</span>
<span class="code-line">web_1  |  * Debugger is active!</span>
<span class="code-line">web_1  |  * Debugger pin code: 201-487-104</span>
<span class="code-line"></code></pre></div>

<p>Ahora para crear la base de datos se usa docker desde otra consola en el mismo directorio del proyecto:</p>
<p>Primero un <code>docker ps</code>:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="n">docker</span><span class="w"> </span><span class="n">ps</span><span class="w"> </span></span>
<span class="code-line"><span class="n">CONTAINER</span><span class="w"> </span><span class="n">ID</span><span class="w">        </span><span class="n">IMAGE</span><span class="w">               </span><span class="n">COMMAND</span><span class="w">                  </span><span class="n">CREATED</span><span class="w">              </span><span class="n">STATUS</span><span class="w">              </span><span class="n">PORTS</span><span class="w">                    </span><span class="n">NAMES</span><span class="w"></span></span>
<span class="code-line"><span class="mi">52</span><span class="n">bf03d39d06</span><span class="w">        </span><span class="n">tutorialflask_web</span><span class="w">   </span><span class="s">&quot;/bin/sh -c &#39;</span><span class="n">python</span><span class="w"> </span><span class="n">r</span><span class="s">&quot;   About a minute ago   Up About a minute   0.0.0.0:5000-&gt;5000/tcp   tutorialflask_web_1</span></span>
<span class="code-line"></code></pre></div>

<p>Ya se tiene el ID del contenedor, ahora  a ejecutar <code>docker exec</code>:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="nv">docker</span> <span class="k">exec</span> <span class="o">-</span><span class="nv">ti</span> <span class="mi">52</span><span class="nv">bf03d39d06</span> .<span class="o">/</span><span class="nv">db_create</span>.<span class="nv">py</span></span>
<span class="code-line"></code></pre></div>

<p>Ahora se ejecuta un <code>ls -l</code> y se tiene lo siguiente:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>drwxr-xr-x 4 ernesto ernesto 4096 sep 12 20:07 app</span>
<span class="code-line">-rw-r--r-- 1 root    root    7168 sep 12 22:31 app.db</span>
<span class="code-line">-rw-r--r-- 1 ernesto ernesto  620 sep 12 22:14 config.py</span>
<span class="code-line">-rwxr-xr-x 1 ernesto ernesto  773 sep 12 20:29 db_create.py</span>
<span class="code-line">-rwxr-xr-x 1 ernesto ernesto  619 sep 12 20:31 db_downgrade.py</span>
<span class="code-line">-rwxr-xr-x 1 ernesto ernesto 1530 sep 12 20:37 db_migrate.py</span>
<span class="code-line">drwxr-sr-x 4 root    root    4096 sep 12 22:31 db_repository</span>
<span class="code-line">-rwxr-xr-x 1 ernesto ernesto  456 sep 12 20:52 db_upgrade.py</span>
<span class="code-line">-rw-r--r-- 1 ernesto ernesto   67 sep  4 17:27 docker-compose.yml</span>
<span class="code-line">-rw-r--r-- 1 ernesto ernesto  480 sep  4 17:27 Dockerfile</span>
<span class="code-line">drwxr-xr-x 2 root    root    4096 sep 12 22:29 __pycache__</span>
<span class="code-line">-rw-r--r-- 1 ernesto ernesto    0 sep  4 17:27 README.md</span>
<span class="code-line">-rw-r--r-- 1 ernesto ernesto   79 sep  4 17:27 run.py</span>
<span class="code-line">drwxr-xr-x 2 ernesto ernesto 4096 sep 19  2014 tmp</span>
<span class="code-line"></code></pre></div>

<p>Se crearon el archivo <code>app.db</code> y el directorio <code>__py__cache__</code>.</p>
<p>Ahora se ejecutará la primera migración: </p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="nv">docker</span> <span class="k">exec</span> <span class="o">-</span><span class="nv">ti</span> <span class="mi">52</span><span class="nv">bf03d39d06</span> .<span class="o">/</span><span class="nv">db_migrate</span>.<span class="nv">py</span> </span>
<span class="code-line"><span class="nv">New</span> <span class="nv">migration</span> <span class="nv">saved</span> <span class="nv">as</span> <span class="o">/</span><span class="nv">code</span><span class="o">/</span><span class="nv">db_repository</span><span class="o">/</span><span class="nv">versions</span><span class="o">/</span><span class="mi">001</span><span class="nv">_migration</span>.<span class="nv">py</span></span>
<span class="code-line"><span class="nv">Current</span> <span class="nv">database</span> <span class="nv">version</span>: <span class="mi">1</span></span>
<span class="code-line"></code></pre></div>

<p>Se salvó la primera migración y el número de versión es 1. Al listar los archivos</p>
<p>y directorios se tiene lo siguiente:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>drwxr-xr-x 4 ernesto ernesto 4096 sep 12 20:07 app</span>
<span class="code-line">-rw-r--r-- 1 root    root    7168 sep 12 22:33 app.db</span>
<span class="code-line">-rw-r--r-- 1 ernesto ernesto  620 sep 12 22:14 config.py</span>
<span class="code-line">-rwxr-xr-x 1 ernesto ernesto  773 sep 12 20:29 db_create.py</span>
<span class="code-line">-rwxr-xr-x 1 ernesto ernesto  619 sep 12 20:31 db_downgrade.py</span>
<span class="code-line">-rwxr-xr-x 1 ernesto ernesto 1530 sep 12 20:37 db_migrate.py</span>
<span class="code-line">drwxr-sr-x 4 root    root    4096 sep 12 22:31 db_repository</span>
<span class="code-line">-rwxr-xr-x 1 ernesto ernesto  456 sep 12 20:52 db_upgrade.py</span>
<span class="code-line">-rw-r--r-- 1 ernesto ernesto   67 sep  4 17:27 docker-compose.yml</span>
<span class="code-line">-rw-r--r-- 1 ernesto ernesto  480 sep  4 17:27 Dockerfile</span>
<span class="code-line">drwxr-xr-x 2 root    root    4096 sep 12 22:29 __pycache__</span>
<span class="code-line">-rw-r--r-- 1 ernesto ernesto    0 sep  4 17:27 README.md</span>
<span class="code-line">-rw-r--r-- 1 ernesto ernesto   79 sep  4 17:27 run.py</span>
<span class="code-line">drwxr-xr-x 2 ernesto ernesto 4096 sep 19  2014 tmp</span>
<span class="code-line"></code></pre></div>

<p>Ahora se tiene el directorio <code>db_repository</code>.</p>
<p>Ahora se trabajará con la base de datos de manera interactiva, se ejecuta <code>docker exec</code>:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="n">docker</span> <span class="n">exec</span> <span class="o">-</span><span class="n">ti</span> <span class="mi">52</span><span class="n">bf03d39d06</span> <span class="n">python</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">Python</span> <span class="mf">3.5.2</span> <span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="n">Aug</span> <span class="mi">22</span> <span class="mi">2016</span><span class="p">,</span> <span class="mi">21</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">27</span><span class="p">)</span> </span>
<span class="code-line"><span class="p">[</span><span class="n">GCC</span> <span class="mf">4.9.2</span><span class="p">]</span> <span class="n">on</span> <span class="n">linux</span></span>
<span class="code-line"><span class="n">Type</span> <span class="s2">&quot;help&quot;</span><span class="p">,</span> <span class="s2">&quot;copyright&quot;</span><span class="p">,</span> <span class="s2">&quot;credits&quot;</span> <span class="ow">or</span> <span class="s2">&quot;license&quot;</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span><span class="o">.</span></span>
<span class="code-line"><span class="o">&gt;&gt;&gt;</span></span>
<span class="code-line"></code></pre></div>

<p>De la aplicación se importa db y models:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">db</span><span class="p">,</span> <span class="n">models</span></span>
<span class="code-line"></code></pre></div>

<p>Se crea un usuario:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="p">(</span><span class="n">usuario</span><span class="o">=</span><span class="s1">&#39;john&#39;</span><span class="p">,</span> <span class="n">correo</span><span class="o">=</span><span class="s1">&#39;john@email.com&#39;</span><span class="p">)</span></span>
<span class="code-line"><span class="o">&gt;&gt;&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">u</span><span class="p">)</span></span>
<span class="code-line"><span class="o">&gt;&gt;&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></span>
<span class="code-line"></code></pre></div>

<p>Se crea otro usuario:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="p">(</span><span class="n">usuario</span><span class="o">=</span><span class="s1">&#39;jane&#39;</span><span class="p">,</span> <span class="n">correo</span><span class="o">=</span><span class="s1">&#39;jane@email.com&#39;</span><span class="p">)</span></span>
<span class="code-line"><span class="o">&gt;&gt;&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>                                       </span>
<span class="code-line"><span class="o">&gt;&gt;&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></span>
<span class="code-line"></code></pre></div>

<p>Se hace una consulta de los usuarios:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">users</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></span>
<span class="code-line"><span class="o">&gt;&gt;&gt;</span> <span class="n">users</span></span>
<span class="code-line"><span class="p">[</span><span class="o">&lt;</span><span class="n">User</span> <span class="s1">&#39;john&#39;</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">User</span> <span class="s1">&#39;jane&#39;</span><span class="o">&gt;</span><span class="p">]</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span></span>
<span class="code-line"><span class="o">...</span>     <span class="nb">print</span> <span class="p">(</span><span class="n">user</span><span class="p">)</span>  </span>
<span class="code-line"><span class="o">...</span> </span>
<span class="code-line"><span class="o">&lt;</span><span class="n">User</span> <span class="s1">&#39;john&#39;</span><span class="o">&gt;</span></span>
<span class="code-line"><span class="o">&lt;</span><span class="n">User</span> <span class="s1">&#39;jane&#39;</span><span class="o">&gt;</span></span>
<span class="code-line"></code></pre></div>

<p>Obtener información del usuario con id 1:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></span>
<span class="code-line"><span class="o">&gt;&gt;&gt;</span> <span class="n">u</span></span>
<span class="code-line"><span class="o">&lt;</span><span class="n">User</span> <span class="s1">&#39;john&#39;</span><span class="o">&gt;</span></span>
<span class="code-line"></code></pre></div>

<p>Ahora se agregarán unos posts:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">datetime</span></span>
<span class="code-line"><span class="o">&gt;&gt;&gt;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></span>
<span class="code-line"><span class="o">&gt;&gt;&gt;</span> <span class="n">p</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Post</span><span class="p">(</span><span class="n">cuerpo</span><span class="o">=</span><span class="s1">&#39;mi primer post!&#39;</span><span class="p">,</span> <span class="n">timestamp</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">(),</span> <span class="n">author</span><span class="o">=</span><span class="n">u</span><span class="p">)</span>            </span>
<span class="code-line"><span class="o">&gt;&gt;&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>                               </span>
<span class="code-line"><span class="o">&gt;&gt;&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></span>
<span class="code-line"><span class="err">```</span><span class="n">python</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">Se</span> <span class="n">sale</span> <span class="k">del</span> <span class="n">interprete</span> <span class="n">de</span> <span class="n">comandos</span><span class="o">.</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">Ahora</span> <span class="n">se</span> <span class="n">usará</span> <span class="err">`</span><span class="n">sqlitebrowser</span><span class="err">`</span> <span class="n">para</span> <span class="n">revisar</span> <span class="n">la</span> <span class="n">base</span> <span class="n">de</span> <span class="n">datos</span> <span class="err">`</span><span class="n">app</span><span class="o">.</span><span class="n">db</span><span class="err">`</span><span class="p">:</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">En</span> <span class="n">la</span> <span class="n">figura</span> <span class="n">se</span> <span class="n">muestra</span> <span class="n">la</span> <span class="n">pantalla</span> <span class="n">principal</span> <span class="n">de</span> <span class="n">la</span> <span class="n">aplicación</span> <span class="n">donde</span> <span class="n">se</span> <span class="n">ve</span> <span class="n">las</span> <span class="n">sentencias</span> <span class="n">SQL</span> <span class="n">para</span> <span class="n">la</span> </span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">creación</span> <span class="n">de</span> <span class="n">las</span> <span class="n">tablas</span><span class="p">:</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="err">!</span><span class="p">[](</span><span class="o">./</span><span class="n">images</span><span class="o">/</span><span class="n">tutorialdeflask4</span><span class="o">-</span><span class="mf">1.</span><span class="n">png</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">Ahora</span> <span class="n">se</span> <span class="n">muestra</span> <span class="n">los</span> <span class="n">datos</span><span class="p">,</span> <span class="n">la</span> <span class="n">tabla</span> <span class="n">usuario</span> <span class="n">y</span> <span class="n">la</span> <span class="n">tabla</span> <span class="n">de</span> <span class="n">post</span><span class="p">:</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="err">!</span><span class="p">[](</span><span class="o">./</span><span class="n">images</span><span class="o">/</span><span class="n">tutorialdeflask4</span><span class="o">-</span><span class="mf">2.</span><span class="n">png</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="err">!</span><span class="p">[](</span><span class="o">./</span><span class="n">images</span><span class="o">/</span><span class="n">tutorialdeflask4</span><span class="o">-</span><span class="mf">3.</span><span class="n">png</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">Para</span> <span class="n">detener</span> <span class="n">el</span> <span class="n">contenedor</span> <span class="n">se</span> <span class="n">ejecuta</span><span class="p">:</span></span>
<span class="code-line"></code></pre></div>

<p>docker-compose down</p>
<p>```</p>
<p>El código fuente de este artículo se encuentra en <a href="https://gitlab.com/ecrespo/tutorial-flask/tree/articulo4">gitlab en la rama articulo4</a>.</p>
<h2></h2>
<p>¡Haz tu donativo!
Si te gustó el artículo puedes realizar un donativo con Bitcoin (BTC)
usando la billetera digital de tu preferencia a la siguiente
dirección: 17MtNybhdkA9GV3UNS6BTwPcuhjXoPrSzV</p>
<p>O Escaneando el código QR desde la billetera:</p>
<p><img alt="17MtNybhdkA9GV3UNS6BTwPcuhjXoPrSzV" src="./images/17MtNybhdkA9GV3UNS6BTwPcuhjXoPrSzV.png"></p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://ecrespo.github.io/tag/python.html">Python</a>
      <a href="https://ecrespo.github.io/tag/flask.html">Flask</a>
      <a href="https://ecrespo.github.io/tag/docker.html">Docker</a>
      <a href="https://ecrespo.github.io/tag/sqlite3.html">Sqlite3</a>
    </p>
  </div>


  <div class="neighbors">
    <a class="btn float-left" href="https://ecrespo.github.io/tutorial-de-flask-parte-3-formulario-web.html" title="Tutorial de Flask parte 3 (formulario web)">
      <i class="fa fa-angle-left"></i> Previous Post
    </a>
    <a class="btn float-right" href="https://ecrespo.github.io/instalacion-de-open365io-en-un-servidor-debian-jessie-local.html" title="Instalación de open365.io en un servidor Debian Jessie local">
      Next Post <i class="fa fa-angle-right"></i>
    </a>
  </div>

  <div class="related-posts">
    <h4>You might enjoy</h4>
    <ul class="related-posts">
      <li><a href="https://ecrespo.github.io/tutorial-de-flask-parte-5-login-de-los-usuarios.html">Tutorial de Flask parte 5 (login de los usuarios)</a></li>
      <li><a href="https://ecrespo.github.io/api-rest-ful-con-flask-y-mongodb-flask-mongoalchemy-y-flask-restful.html">API Rest Ful con Flask y MongoDB (Flask-MongoAlchemy y Flask-restful)</a></li>
      <li><a href="https://ecrespo.github.io/api-rest-ful-con-flask-y-mongodb-flask-mongoalchemy.html">API Rest Ful con Flask y MongoDB (Flask-MongoAlchemy)</a></li>
      <li><a href="https://ecrespo.github.io/crud-usando-flask-y-mongodb-con-orm-flask-mongoalchemy-parte-4.html">CRUD usando Flask y MongoDB con ORM Flask-MongoAlchemy (parte 4)</a></li>
      <li><a href="https://ecrespo.github.io/crud-usando-flask-para-mongodb-parte-3.html">CRUD usando Flask para MongoDB (parte 3).</a></li>
    </ul>
  </div>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle ads-responsive"
         data-ad-client="pub-0261001661746989"
         data-ad-slot="1234566"></ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>

<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'https://seraphto.disqus.com';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
    Please enable JavaScript to view comments.
</noscript>
<!-- End Disqus -->
</article>

    <footer>
<p>&copy; 2022 </p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Página de Seraph ",
  "url" : "https://ecrespo.github.io",
  "image": "//s.gravatar.com/avatar/7fab2070e149e57fe99da94d7ccbad6b?s=120",
  "description": " Software Libre, Ciencia de Datos y Python"
}
</script>


</body>
</html>