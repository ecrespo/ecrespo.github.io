
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://ecrespo.github.io/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://ecrespo.github.io/theme/pygments/monokai.min.css">
  <link rel="stylesheet" type="text/css" href="https://ecrespo.github.io/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://ecrespo.github.io/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://ecrespo.github.io/theme/font-awesome/css/solid.css">


    <link href="https://ecrespo.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Página de Seraph Atom">



<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-131517246-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->
    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#333333">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#333333">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Microsoft EDGE -->
    <meta name="msapplication-TileColor" content="#333333">

<meta name="author" content="Ernesto Crespo" />
<meta name="description" content="Se creará un API rest asíncrono (usando aiohttp), donde se valida la entrada con cerberus" />
<meta name="keywords" content="Debian, Python, aiohttp, Ubuntu, API rest, asincrono, Cerberus">

<meta property="og:site_name" content="Página de Seraph"/>
<meta property="og:title" content="Validando un API rest asíncrono con Cerberus"/>
<meta property="og:description" content="Se creará un API rest asíncrono (usando aiohttp), donde se valida la entrada con cerberus"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://ecrespo.github.io/apirest-aiohttp-cerberus-2019.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2019-06-08 19:33:00-04:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://ecrespo.github.io/author/ernesto-crespo.html">
<meta property="article:section" content="Tutorial de Python"/>
<meta property="article:tag" content="Debian"/>
<meta property="article:tag" content="Python"/>
<meta property="article:tag" content="aiohttp"/>
<meta property="article:tag" content="Ubuntu"/>
<meta property="article:tag" content="API rest"/>
<meta property="article:tag" content="asincrono"/>
<meta property="article:tag" content="Cerberus"/>
<meta property="og:image" content="//s.gravatar.com/avatar/7fab2070e149e57fe99da94d7ccbad6b?s=120">

  <title>Página de Seraph &ndash; Validando un API rest asíncrono con Cerberus</title>

</head>
<body>
  <aside>
    <div>
      <a href="https://ecrespo.github.io">
        <img src="//s.gravatar.com/avatar/7fab2070e149e57fe99da94d7ccbad6b?s=120" alt="Ernesto Crespo" title="Ernesto Crespo">
      </a>
      <h1><a href="https://ecrespo.github.io">Ernesto Crespo</a></h1>

<p>Data Scientist </p>
      <nav>
        <ul class="list">
          <li><a href="https://ecrespo.github.io/pages/About.html#About">Acerca</a></li>
          <li><a href="https://ecrespo.github.io/pages/Contacto.html#Contacto">Contacto</a></li>

        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-medium" href="https://medium.com/@_seraph1" target="_blank">
            <i class="fab fa-medium">
            </i>
          </a></li>
          <li>
            <a  class="sc-linkedin" href="http://ve.linkedin.com/in/ernestocrespo" target="_blank">
            <i class="fab fa-linkedin">
            </i>
          </a></li>
          <li>
            <a  class="sc-github" href="https://github.com/ecrespo" target="_blank">
            <i class="fab fa-github">
            </i>
          </a></li>
          <li>
            <a  class="sc-google" href="https://google.com/+ErnestoCrespo" target="_blank">
            <i class="fab fa-google">
            </i>
          </a></li>
          <li>
            <a  class="sc-twitter" href="https://twitter.com/_seraph1" target="_blank">
            <i class="fab fa-twitter">
            </i>
          </a></li>
          <li>
            <a  class="sc-facebook" href="https://www.facebook.com/ernesto.crespo" target="_blank">
            <i class="fab fa-facebook">
            </i>
          </a></li>
          <li>
            <a  class="sc-gitlab" href="https://gitlab.com/ecrespo" target="_blank">
            <i class="fab fa-gitlab">
            </i>
          </a></li>
          <li>
            <a  class="sc-soundcloud" href="https://soundcloud.com/ernesto-crespo" target="_blank">
            <i class="fab fa-soundcloud">
            </i>
          </a></li>
          <li>
            <a  class="sc-rss" href="//www.seraph.to/feeds/all.atom.xml" target="_blank">
            <i class="fas fa-rss">
            </i>
          </a></li>
      </ul>
    </div>
    
    <ul class="tagcloud">
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/simplecv.html">
            SimpleCV
                    <span class="badge">4</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/profiling.html">
            Profiling
                    <span class="badge">3</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/pylint.html">
            PyLint
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/seguridad.html">
            Seguridad
                    <span class="badge">4</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/cerberus.html">
            Cerberus
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/python-dns.html">
            python-dns
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/rasbian.html">
            Rasbian
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/exif.html">
            exif
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/beautiful-soup.html">
            Beautiful Soup
                    <span class="badge">3</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/webkit.html">
            webkit
                    <span class="badge">2</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/fedora.html">
            Fedora
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/rasberry-pi.html">
            Rasberry Pi
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/paquetes.html">
            Paquetes
                    <span class="badge">2</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/libpam.html">
            libpam
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/ecryptfs.html">
            eCryptfs
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/django.html">
            Django
                    <span class="badge">4</span>
            </a>
        </li>
        <li class="tag-1">
            <a href="https://ecrespo.github.io/tag/python.html">
            Python
                    <span class="badge">162</span>
            </a>
        </li>
        <li class="tag-2">
            <a href="https://ecrespo.github.io/tag/pyqt.html">
            PyQt
                    <span class="badge">13</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/mechanize.html">
            Mechanize
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/tareas.html">
            Tareas
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-2">
            <a href="https://ecrespo.github.io/tag/twitter.html">
            Twitter
                    <span class="badge">6</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/scipy.html">
            scipy
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/networkx.html">
            Networkx
                    <span class="badge">2</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/webview.html">
            webview
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-2">
            <a href="https://ecrespo.github.io/tag/accesibilidad.html">
            Accesibilidad
                    <span class="badge">10</span>
            </a>
        </li>
        <li class="tag-2">
            <a href="https://ecrespo.github.io/tag/webscraping.html">
            Webscraping
                    <span class="badge">6</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/dns.html">
            DNS
                    <span class="badge">3</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/ipython.html">
            ipython
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/paramiko.html">
            Paramiko
                    <span class="badge">2</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/ipcalc.html">
            ipcalc
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-1">
            <a href="https://ecrespo.github.io/tag/canaima.html">
            Canaima
                    <span class="badge">70</span>
            </a>
        </li>
        <li class="tag-1">
            <a href="https://ecrespo.github.io/tag/debian.html">
            Debian
                    <span class="badge">115</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/snmp.html">
            snmp
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/videos.html">
            Videos
                    <span class="badge">2</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/python-daemon.html">
            Python-daemon
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/aiohttp.html">
            aiohttp
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/wikipedia.html">
            Wikipedia
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/gconf.html">
            gconf
                    <span class="badge">4</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/grafos.html">
            grafos
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/ssh.html">
            ssh
                    <span class="badge">5</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/kvm.html">
            KVM
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-2">
            <a href="https://ecrespo.github.io/tag/mercurial.html">
            Mercurial
                    <span class="badge">8</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/asincrono.html">
            asincrono
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/camara.html">
            Camara
                    <span class="badge">4</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/freebsd.html">
            FreeBSD
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/tareas-periodicas.html">
            Tareas periodicas
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/dia-debian.html">
            Dia Debian
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/pantalla-tactil.html">
            Pantalla táctil
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-2">
            <a href="https://ecrespo.github.io/tag/matplotlib.html">
            matplotlib
                    <span class="badge">21</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/flisol.html">
            FLISOL
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/python-lockfile.html">
            Python-lockfile
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/pyflakes.html">
            Pyflakes
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/qtadb.html">
            Qtadb
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-1">
            <a href="https://ecrespo.github.io/tag/linux.html">
            Linux
                    <span class="badge">133</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/scapy.html">
            scapy
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/line_profiler.html">
            line_profiler
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/pypdf.html">
            pypdf
                    <span class="badge">2</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/tdd.html">
            TDD
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-1">
            <a href="https://ecrespo.github.io/tag/general.html">
            General
                    <span class="badge">89</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/pylab.html">
            pylab
                    <span class="badge">2</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/sms.html">
            SMS
                    <span class="badge">4</span>
            </a>
        </li>
        <li class="tag-2">
            <a href="https://ecrespo.github.io/tag/empaquetado.html">
            Empaquetado
                    <span class="badge">9</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/magnetometro.html">
            Magnetometro
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/codigo-qr.html">
            Código QR
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/api-rest.html">
            API rest
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/acelerometro.html">
            Acelerometro
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/csv.html">
            csv
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/gps.html">
            GPS
                    <span class="badge">2</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/django-celery.html">
            Django-Celery
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/pyprocessing.html">
            Pyprocessing
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-2">
            <a href="https://ecrespo.github.io/tag/glade.html">
            glade
                    <span class="badge">14</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/qemu.html">
            qemu
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-1">
            <a href="https://ecrespo.github.io/tag/ubuntu.html">
            Ubuntu
                    <span class="badge">74</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/kivy.html">
            kivy
                    <span class="badge">3</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/dnsmasq.html">
            dnsmasq
                    <span class="badge">2</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/tiflotecnologia.html">
            tiflotecnologia
                    <span class="badge">3</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/bitly.html">
            bit.ly
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-2">
            <a href="https://ecrespo.github.io/tag/control-de-versiones.html">
            Control de versiones
                    <span class="badge">6</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/api-stream.html">
            API Stream
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/etckeeper.html">
            etckeeper
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-2">
            <a href="https://ecrespo.github.io/tag/numpy.html">
            numpy
                    <span class="badge">19</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/unittest.html">
            unittest
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/reproductor-musica.html">
            Reproductor Música
                    <span class="badge">2</span>
            </a>
        </li>
        <li class="tag-2">
            <a href="https://ecrespo.github.io/tag/zeromq.html">
            ZeroMQ
                    <span class="badge">9</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/pyowm.html">
            PyOWM
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/qt.html">
            qt
                    <span class="badge">2</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/doctest.html">
            doctest
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/redes.html">
            Redes
                    <span class="badge">5</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/pyqwt.html">
            pyQwt
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/csvkit.html">
            csvkit
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/scrapermark.html">
            Scrapermark
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/cprofile.html">
            cProfile
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/pudb.html">
            pudb
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-1">
            <a href="https://ecrespo.github.io/tag/android.html">
            Android
                    <span class="badge">41</span>
            </a>
        </li>
        <li class="tag-2">
            <a href="https://ecrespo.github.io/tag/gtk.html">
            gtk
                    <span class="badge">15</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/asus.html">
            Asus
                    <span class="badge">2</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/usb.html">
            usb
                    <span class="badge">1</span>
            </a>
        </li>
        <li class="tag-2">
            <a href="https://ecrespo.github.io/tag/gnome.html">
            gnome
                    <span class="badge">19</span>
            </a>
        </li>
        <li class="tag-3">
            <a href="https://ecrespo.github.io/tag/arduino.html">
            Arduino
                    <span class="badge">2</span>
            </a>
        </li>
        <li class="tag-4">
            <a href="https://ecrespo.github.io/tag/timeit.html">
            timeit
                    <span class="badge">1</span>
            </a>
        </li>
   </ul>



  </aside>
  <main>

    <nav>
      <a href="https://ecrespo.github.io">    Home
</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="https://ecrespo.github.io/feeds/all.atom.xml">    Atom
</a>

    </nav>

<article class="single">
  <header>
      
    <h1 id="apirest-aiohttp-cerberus-2019">Validando un API rest asíncrono con Cerberus</h1>
    <p>
          Posted on sáb 08 junio 2019 in <a href="https://ecrespo.github.io/category/tutorial-de-python.html">Tutorial de Python</a>


        &#8226; 8 min read
    </p>
  </header>


  <div>
    <p>En este art&iacute;culo se mostrar&aacute; como crear un API rest asincrono usando aiohttp, se usar&aacute; un script para acceder a la base de datos NoSQL RethinkDB de manera as&iacute;ncrona,
y 2 formas de validar la entrada de datos del API, la primera evaluando cada variable, la segunda se usar&aacute; cerberus donde se tiene un esquema de la entrada de datos y
por &uacute;ltimo la tercera, usar&aacute; cerberus pero el esquema estar&aacute; guardado en rethinkdb.</p>
<p>El repositorio del c&oacute;digo completo de este tutorial se encuentra en <a href="https://gitlab.com/ecrespo/async-api-rest-example/tree/master">github</a>.</p>
<p>Este art&iacute;culo se basa en el art&iacute;culo <a href="https://www.ecalamia.com/blog/data-validation-robust-apis/">Using Data Validation for Robust APIs</a> y en el
art&iacute;culo <a href="https://blog.apcelent.com/create-rest-api-using-aiohttp.html">How to create REST API using aiohttp</a>, donde se explica como hacer un API rest sincr&oacute;nico con aiohttp.</p>
<p>La documentaci&oacute;n de cerberus la pueden ver en el siguiente <a href="https://cerberus-sanhe.readthedocs.io/usage.html">cerberus</a>.</p>
<p>Se tiene la siguiente estructura de directorios y archivos del API rest:</p>
<p><code>async-api-rest-example
├── app.py
├── README.md
├── resources
│&nbsp;&nbsp; ├── api_resources.py
│&nbsp;&nbsp; ├── home.py
│&nbsp;&nbsp; ├── __init__.py
│&nbsp;&nbsp; └── rethink_async.py
└── run.py</code></p>
<p>Descripci&oacute;n de los archivos:</p>
<ul>
<li>app.py: Se definen las rutas de los endpoint del API rest.</li>
<li>run.py: Script que permite correr el API rest.</li>
<li>resources/rethin_async.py: M&oacute;dulo que permite acceder de manera as&iacute;ncrona a rethinkdb.</li>
<li>resources/home.py: P&aacute;gina de inicio del API rest.</li>
<li>resources/api_resources.py: Donde se define los m&eacute;todos HTTP del API rest.</li>
</ul>
<h3 id="script run.py">Script run.py</h3>
<p>Este script permite iniciar el API rest, a continuaci&oacute;n el c&oacute;digo:</p>
<p>```python</p>
<h1 id="!/usr/bin/env python3_1">!/usr/bin/env python3</h1>
<h1 id="se importa aiohttp">Se importa aiohttp</h1>
<p>from aiohttp import web</p>
<h1 id="se importa las rutas de los endpoint">Se importa las rutas de los endpoint</h1>
<p>from app import setup_routes</p>
<p>async def init_app():
    #Se instancia la aplicaci&oacute;n
    app = web.Application()
    #A la aplicaci&oacute;n se le pasa las rutas
    setup_routes(app)
    #Se retorna la aplicaci&oacute;n
    return app</p>
<p>def main():
    #Se define la direcci&oacute;n del host, el puerto y se corre la Ap en dicha IP y puerto
    host = '0.0.0.0'
    port = 5000
    app = init_app()</p>
<pre><code>web.run_app(app,host=host, port=port)
</code></pre>
<p>if <strong>name</strong> == '<strong>main</strong>':
    main()</p>
<p>```</p>
<h3 id="script app.py">Script app.py</h3>
<p>Este script define las rutas y URLs de los endpoint del API rest. A continuaci&oacute;n el c&oacute;digo:</p>
<p>```python</p>
<h1 id="se importa los recursos del api rest y el home ._1">Se importa los recursos del api rest y el home .</h1>
<p>from resources.api_resources import Student
from resources.home import getIndex</p>
<p>def setup_routes(app):
    student = Student()
    #Se tiene 3 endpoints, el primero validaci&oacute;n cl&aacute;sica,
    # el segundo validando con cerberus, y el 3ero con cerberus
    #pero guardando el esquema de validaci&oacute;n en una base de datos
    app.router.add_post('/api/v1/student1',student.getData1)
    app.router.add_post('/api/v1/student2',student.getData2)
    app.router.add_post('/api/v1/student3',student.getData3)
    #Por seguridad no se permite ingresar a la raiz del API rest
    app.router.add_get('/api/v1/', getIndex)
    app.router.add_get('/', getIndex)</p>
<p>```</p>
<h3 id="script rethink_async.py">Script rethink_async.py</h3>
<p>```python</p>
<h1 id="!/usr/bin/env python3_3">!/usr/bin/env python3</h1>
<p>import rethinkdb as r
import asyncio
from datetime import datetime</p>
<p>r.set_loop_type("asyncio")</p>
<p>async def createDB(server,port,database):
    """
    Create DB to database server.</p>
<pre><code>Parameters
----------
server: IP server to connect
port: Port server to connect
database: Database name to create

"""
conn = await r.connect(server, port)
if database not in await r.db_list().run(conn):
    return await r.db_create(database).run(conn)
</code></pre>
<p>async def createTable(server,port,database,table):
    """
    Create Table in database.</p>
<pre><code>Parameters
----------
server: IP server to connect
port: Port server to connect
database: Database name to connect
"""
conn = await r.connect(server, port)
return await r.db(database).table_create(table).run(conn)
</code></pre>
<p>async def listdb(server,port):
    """
    List all database in database server.</p>
<pre><code>Parameters
----------
server: IP server to connect
port: Port server to connect
"""
conn = await r.connect(server, port)
return await r.db_list(conn)
</code></pre>
<p>async def listtables(server,port,database):
    """
    Lista tables from database.</p>
<pre><code>Parameters
----------
server: IP server to connect
port: Port server to connect
database: Database name to list tables
"""
conn = await r.connect(server, port)
return await r.db(database).table_list().run(conn)
</code></pre>
<p>async def insert(server,port,database,table,data):
    """
    Insert dictionary  in table.</p>
<pre><code>Parameters
----------
server: IP server to connect
port: Port server to connect
database: Database name to connect
table: table to insert Dictionary
data: Dictionary data to insert
"""
conn = await r.connect(server, port)
result = await r.db(database).table(table).insert(data).run(conn)
await conn.close()
return result
</code></pre>
<p>async def getAll(server,port,database,table,pattern=None):
    """
    Get All documents from pattern search</p>
<pre><code>Parameters
----------
server: IP server to connect
port: Port server to connect
database: Database name to connect
table: table name to search
pattern: Dictionary with pattern search
"""
conn = await r.connect(server, port)
if pattern == None:
    cursor = await r.db(database).table(table).run(conn)
else:
    cursor = await r.db(database).table(table).filter(pattern).run(conn)
elements = list()

while (await cursor.fetch_next()):
    item = await cursor.next()
    elements.append(item)

await conn.close()

return elements
</code></pre>
<p>async def getFirst(server, port, database, table, pattern = None):
    """
    Get first document from pattern search</p>
<pre><code>Parameters
----------
server: IP server to connect
port: Port server to connect
database: Database name to connect
table: table name to search
pattern: Dictionary with pattern search
"""
conn = await r.connect(server, port)
if pattern == None:
    cursor = await r.db(database).table(table).run(conn)
else:
    cursor = await  r.db(database).table(table).filter(pattern).run(conn)
elements = list()

while (await  cursor.fetch_next()):
    item = await cursor.next()
    elements.append(item)
    break
await conn.close()
return elements
</code></pre>
<p>async def delete(server,port,database,table,pattern):
    """
    Delete a  document from pattern search</p>
<pre><code>Parameters
----------
server: IP server to connect
port: Port server to connect
database: Database name to connect
table: table name to search
pattern: Dictionary with pattern search
"""
conn = await r.connect(server, port)
result =  await r.db(database).table(table).filter(pattern).delete().run(conn)
await conn.close()
return result
</code></pre>
<p>async def update(server,port,database,table,data,pattern=None):
    """
    Update a document from pattern search</p>
<pre><code>Parameters
----------
server: IP server to connect
port: Port server to connect
database: Database name to connect
table: table name to search
pattern: Dictionary with pattern search
"""
conn = await r.connect(server, port)
if (type(data) == type(dict())):
    if pattern == None :
        result = await r.db(database).table(table).update(data).run(conn)
        await conn.close()
        return result
    else:
        result =  await r.db(database).table(table).filter(pattern).update(data).run(conn)
        await conn.close()
        return result
</code></pre>
<p>```</p>
<h3 id="script api_resouces.py">Script api_resouces.py</h3>
<p>En el script se tienen 3 m&eacute;todos:</p>
<ul>
<li>getData1: Este m&eacute;todo v&aacute;lida cada una de las entrada de datos.</li>
<li>getData2: Este m&eacute;todo v&aacute;lida la entrada de datos con un esquema validando con cerberus.</li>
<li>getData3: Este m&eacute;todo vuelve a usar cerberus pero ahora tomando el esquema a validar usando rethinkdb.</li>
</ul>
<p>A continuaci&oacute;n se muestra el c&oacute;digo:</p>
<p>```python</p>
<p>import json
from aiohttp import web
from cerberus import Validator
import rethinkdb as r</p>
<p>from .rethink_async import *</p>
<p><strong>version</strong> = '0.0.1'</p>
<p>student_schema = {
    'uid': {
        'required': True,
        'type': 'integer',
    },
    'age': {
        'required': True,
        'type': 'integer',
        'min': 18,
        'max': 35,
    },
    'name': {
        'required': True,
        'type': 'string',
        'maxlength': 50,
    },
    'grade': {
        'required': False,
        'type': 'string',
        'allowed': ['A', 'B', 'C'],
    }
}</p>
<p>class Student(object):</p>
<pre><code>def __init__(self):
    pass

async def getData1(self,request):

    #Se convierte el json a un diccionario

    try:
        data = json.loads(await request.text())
    except json.JSONDecodeError:
        response_obj = {'status': 'failed', 'reason': "Ill-formed JSON"}
        return web.Response(text=json.dumps(response_obj), status=205)

    #Se valida los datos de entrada
    try:
        uid = int(data['uid'])
    except (KeyError, ValueError):
        response_obj = {'status': 'failed', 'reason': "Expecting uid:int"}
        return web.Response(text=json.dumps(response_obj), status=205)

    try:
        age = int(data['age'])
        if not 18 &lt; age &lt; 35:
            raise ValueError('Bad age')
    except (KeyError, ValueError):
        response_obj = {'status': 'failed', 'reason': "Expecting age:int within the range [18:35]"}
        return web.Response(text=json.dumps(response_obj), status=205)

    try:
        name = str(data['name'])
        if len(name) &gt; 50:
            raise ValueError('Max limit 50')
    except (KeyError, ValueError):
        response_obj = {'status': 'failed', 'reason': "Expecting name:str within the range [0:50]"}
        return web.Response(text=json.dumps(response_obj), status=205)

    try:
        grade = data.get('grade')
        if grade is None:
            grade = 'A'
        if grade not in ('A', 'B', 'C'):
            response_obj = {'status': 'failed', 'reason': "A, B or C expected"}
            return web.Response(text=json.dumps(response_obj), status=205)
    except (KeyError, ValueError):
        response_obj = {'status': 'failed', 'reason': "Expecting grade:str A, B or C expected"}
        return web.Response(text=json.dumps(response_obj), status=205)

    #Luego de validar se construye el diccionario de salida de datos como json

    data_output = dict()
    data_output['uid'] = data['uid']
    data_output['age'] = data['age']
    data_output['name'] = data['name']
    data_output['grade'] = data.get('grade', 'A')

    response_obj = {
        'status': 'success',
        'data': data_output
    }
    return web.Response(text=json.dumps(response_obj), status=200, content_type='application/json')



async def getData2(self,request):

    #Se convierte el json del post en un diccionario
    try:
        data = json.loads(await request.text())
    except json.JSONDecodeError:
        response_obj = {'status': 'failed', 'reason': "Ill-formed JSON"}
        return web.Response(text=json.dumps(response_obj), status=205)

    #Con la variable que contiene el esquema se realiza la validaci&oacute;n del json
    student_validator = Validator(student_schema)
    if not student_validator.validate(data):
        msg = student_validator.errors
        response_obj = {'status': 'failed', 'reason': msg}
        return web.Response(text=json.dumps(response_obj), status=205)

    #Se construye el diccionario de la salida de los datos v&iacute;a json
    data_output = dict()
    data_output['uid'] = data['uid']
    data_output['age'] = data['age']
    data_output['name'] = data['name']
    data_output['grade'] = data.get('grade', 'A')

    response_obj = {
        'status': 'success',
        'data': data_output
    }
    return web.Response(text=json.dumps(response_obj), status=200, content_type='application/json')


async def getData3(self,request):

    #Se convierte el json en un diccionario
    try:
        data = json.loads(await request.text())
    except json.JSONDecodeError:
        response_obj = {'status': 'failed', 'reason': "Ill-formed JSON"}
        return web.Response(text=json.dumps(response_obj), status=205)

    #Si yo se, no deber&iacute;a tener  la configuraci&oacute;n de la base de datos ac&aacute;,
    #pero era para no alargar el c&oacute;digo de ejemplo
    #Se definen el servidor, puerto, base de datos, la tabla y el patr&oacute;n de busqueda
    server = "localhost"
    port = 28015
    db = "student"
    table = "student_schema"
    pattern = {"endpoint": "student3"}

    #Se realiza la consulta a rethinkdb de manera asincrona
    student_schemadb = await getFirst(server, port, db, table, pattern)

    #Se quitan del diccionario el id y el endpoint a fin de realizar la evaluaci&oacute;n del esquema
    student_schema = {item: student_schemadb[0][item] for item in list(student_schemadb[0].keys()) if item != 'id'}
    student_schema = {item: student_schema[item] for item in list(student_schema.keys()) if item != 'endpoint'}

    #Se valida el esquema con los datos suministrados v&iacute;a post
    student_validator = Validator(student_schema)
    if not student_validator.validate(data):
        msg = student_validator.errors
        response_obj = {'status': 'failed', 'reason': msg}
        return web.Response(text=json.dumps(response_obj), status=205)

    #Se toman los datos y se colocan en el diccionario para el json de salida
    data_output = dict()
    data_output['uid'] = data['uid']
    data_output['age'] = data['age']
    data_output['name'] = data['name']
    data_output['grade'] = data.get('grade', 'A')

    response_obj = {
        'status': 'success',
        'data': data_output
    }
    return web.Response(text=json.dumps(response_obj), status=200, content_type='application/json')
</code></pre>
<p>```</p>
<h3 id="base de datos rethinkdb con el esquema para cerberus">Base de datos rethinkdb con el esquema para cerberus</h3>
<p>Para que el m&eacute;todo getData3 funcione es necesario tener almacenado en la base de datos rethinkdb el esquema.</p>
<p>El proceso de instalaci&oacute;n de rethinkDB v&iacute;a docker, se deja en el siguiente <a href="https://platzi.com/blog/como-instalar-rethinkdb-docker/">art&iacute;culo de platzi</a>.</p>
<p>Para insertar los datos se ejecuta en el dashboard de rethinkDB (http://localhost:8080) el siguiente comando:</p>
<p><code>r.db("student").table("student_schema").insert({id:1,endpoint: 'student3',uid: {
        'required': true,
        'type': 'integer'},
    age: {
        'required': true,
        'type': 'integer',
        'min': 18,
        'max': 35
    },
    name: {
        'required': true,
        'type': 'string',
        'maxlength': 50
    },
    grade: {
        'required': false,
        'type': 'string',
        'allowed': ['A', 'B', 'C']
  }})</code></p>
<p>De esa forma se inserta los datos en la tabla.</p>
<p>Para consultar la tabla v&iacute;a dashboard se ejecuta:</p>
<p><code>r.db("student").table("student_schema")</code></p>
<p>A continuaci&oacute;n se muestra la tabla:</p>
<p><img alt="Tabla esquema" src="./images/2019-apirest-cerberus-5.png"/></p>
<h3 id="iniciar el api rest.">Iniciar el API rest.</h3>
<p>Para iniciar el API rest se tiene que tener instalado la librer&iacute;a rethinkdb y aiohttp:</p>
<p><code>pip install rethinkdb aiohttp</code></p>
<p>Luego de instalada se ejecuta el script run.py:</p>
<p>```
python run.py</p>
<p>```</p>
<p>Si se tiene la siguiente salida el API rest est&aacute; corriendo sin problemas:</p>
<p>```
======== Running on http://0.0.0.0:5000 ========
(Press CTRL+C to quit)</p>
<p>```</p>
<h3 id="consultas al api rest">Consultas al API rest</h3>
<p>Para consultar el API rest se puede usar insomia o postman, ambos son clientes API rest.</p>
<p>Se tienen 3 endpoint todos v&iacute;a m&eacute;todo post que se le pasar&aacute; un json como el siguiente:</p>
<p><code>json
{
  "uid": 42,
  "age": 25,
  "name": "John Doe",
  "grade": "A"
}</code></p>
<p>Los urls son los siguientes:</p>
<ul>
<li>http://localhost:5000/api/v1/student1 : Usa el m&eacute;todo getData1.</li>
<li>http://localhost:5000/api/v1/student2 : Usa el m&eacute;todo getData2.</li>
<li>http://localhost:5000/api/v1/student3 : Usa el m&eacute;todo getData3.</li>
</ul>
<p>Primer endpoint:</p>
<p>Se realiza la consulta con el json mostrado anteriormente:</p>
<p><img alt="Consulta v&aacute;lida" src="./images/2019-apirest-cerberus-1.png"/></p>
<p>Ahora se modifica por ejemplo la variable grade a X:</p>
<p><img alt="Consulta inv&aacute;lida" src="./images/2019-apirest-cerberus-2.png"/></p>
<p>En este caso el valor X para la variable grade no es v&aacute;lido.</p>
<p>Segundo endpoint:</p>
<p>En este caso se usa cerberus y la variable que contiene el esquema para validar:</p>
<p>Se realiza la consulta con el json original:</p>
<p><img alt="Consulta v&aacute;lida" src="./images/2019-apirest-cerberus-3.png"/></p>
<p>Ahora se realiza la consulta modificando la variable grade con el valor de Z:</p>
<p><img alt="Consulta inv&aacute;lida" src="./images/2019-apirest-cerberus-4.png"/></p>
<p>El mensaje es m&aacute;s gen&eacute;rico no es el que se defini&oacute; en el primer m&eacute;todo.</p>
<p>Tercer endpoint:</p>
<p>Ac&aacute; no se ver&aacute;n cambios significativos en la consulta, lo interesante es que, al tener muchos endpoint con distintas entradas de datos,
lo mejor es usar una base de datos donde se tenga almacenada cada esquema por endpoint.</p>
<p>As&iacute; que el resultado ser&iacute;a el mismo que los del segundo endpoint.</p>
<h2 id="_2"></h2>
<p>&iexcl;Haz tu donativo!
Si te gust&oacute; el art&iacute;culo puedes realizar un donativo con Bitcoin (BTC)
usando la billetera digital de tu preferencia a la siguiente
direcci&oacute;n: 17MtNybhdkA9GV3UNS6BTwPcuhjXoPrSzV</p>
<p>O Escaneando el c&oacute;digo QR desde la billetera:</p>
<p><img alt="17MtNybhdkA9GV3UNS6BTwPcuhjXoPrSzV" src="./images/17MtNybhdkA9GV3UNS6BTwPcuhjXoPrSzV.png"/></p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://ecrespo.github.io/tag/debian.html">Debian</a>
      <a href="https://ecrespo.github.io/tag/python.html">Python</a>
      <a href="https://ecrespo.github.io/tag/aiohttp.html">aiohttp</a>
      <a href="https://ecrespo.github.io/tag/ubuntu.html">Ubuntu</a>
      <a href="https://ecrespo.github.io/tag/api-rest.html">API rest</a>
      <a href="https://ecrespo.github.io/tag/asincrono.html">asincrono</a>
      <a href="https://ecrespo.github.io/tag/cerberus.html">Cerberus</a>
    </p>
  </div>



  <div class="related-posts">
    <h4>    You might enjoy
</h4>
    <ul class="related-posts">
      <li><a href="https://ecrespo.github.io/python-wikipedia-2019.html">Cómo usar el API de wikipedia con Python</a></li>
      <li><a href="https://ecrespo.github.io/manejo-de-colas-de-rabbitmq-en-django-con-django-celery.html">Manejo de colas de RabbitMQ en Django con Django-Celery</a></li>
      <li><a href="https://ecrespo.github.io/reproductor-de-video-con-python-y-kivy.html">Reproductor de vídeo con python y kivy</a></li>
      <li><a href="https://ecrespo.github.io/widget-button-y-scatter-widget-de-comportamiento-en-kivy.html">Widget button y Scatter (widget de comportamiento) en kivy.</a></li>
      <li><a href="https://ecrespo.github.io/desarrollo-de-aplicaciones-multiplataforma-con-python-y-kivy.html">Desarrollo de aplicaciones multiplataforma con python y kivy</a></li>
    </ul>
  </div>


<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'https://seraphto.disqus.com';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
        Please enable JavaScript to view comments.

</noscript>
<!-- End Disqus -->
</article>

    <footer>
<p>&copy;  2006</p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Página de Seraph ",
  "url" : "https://ecrespo.github.io",
  "image": "//s.gravatar.com/avatar/7fab2070e149e57fe99da94d7ccbad6b?s=120",
  "description": " Software Libre, Ciencia de Datos y Python"
}
</script>

</body>
</html>